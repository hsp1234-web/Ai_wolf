# (ä¸­æ–‡å…§å®¹)

# Wolf_V5

## å°ˆæ¡ˆç›®æ¨™

æœ¬å°ˆæ¡ˆæ—¨åœ¨æ‰“é€ ä¸€å€‹åœ¨ Google Colaboratory (Colab) ç’°å¢ƒä¸­é‹è¡Œçš„ã€å…·æœ‰èŠå¤©å¼åœ–å½¢åŒ–ä»‹é¢çš„äººæ©Ÿå”åŒæ™ºæ…§åˆ†æå¹³å°ã€‚å¹³å°å°‡ç”¨æ–¼ç³»çµ±æ€§åœ°è™•ç†ã€Œå–„ç”²ç‹¼aæ©Ÿæ™ºç”Ÿæ´»ã€ç´„150é€±çš„æ­·å²è²¼æ–‡ï¼Œè¼”åŠ©ä½¿ç”¨è€…å›é¡§æ­·å²äº¤æ˜“æ©Ÿæœƒï¼Œä¸¦æœ€çµ‚ç”±ä½¿ç”¨è€…å°‡ç²¾ç…‰å…§å®¹æ‰‹å‹•æ•´ç†è‡³Googleæ–‡ä»¶ã€‚

## å¦‚ä½•åœ¨ Colab ä¸­é‹è¡Œ

æˆ‘å€‘æä¾›äº†å…©ç¨®åœ¨ Google Colaboratory ä¸­å•Ÿå‹• Ai_wolf (Wolf_V5) æ‡‰ç”¨ç¨‹å¼çš„æ–¹æ³•ï¼š

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ç‰ˆæœ¬åŒ–çš„ `run_in_colab.ipynb` Notebook (æ¨è–¦)

é€™æ˜¯å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼çš„**æ¨è–¦æ–¹æ³•**ï¼Œå› ç‚ºå®ƒä½¿ç”¨äº†å°ˆæ¡ˆä¸­ç‰ˆæœ¬åŒ–çš„ Notebook æª”æ¡ˆï¼Œç¢ºä¿äº†å•Ÿå‹•è…³æœ¬èˆ‡å°ˆæ¡ˆç¨‹å¼ç¢¼çš„ä¸€è‡´æ€§ã€‚

1.  **é»æ“Šä¸‹æ–¹æŒ‰éˆ•**ï¼š
    [![åœ¨ Colab ä¸­æ‰“é–‹](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/hsp1234-web/Ai_wolf/blob/main/run_in_colab.ipynb)

2.  **ä¾ç…§ Notebook ä¸­çš„èªªæ˜åŸ·è¡Œ**ï¼š
    *   `run_in_colab.ipynb` åŒ…å«è©³ç´°çš„æ­¥é©Ÿèªªæ˜ï¼ŒåŒ…æ‹¬å¦‚ä½•è¨­å®š API é‡‘é‘° (é€é Colab Secrets Manager)ã€Google Drive æˆæ¬Šç­‰ã€‚
    *   Notebook ä¸­çš„ç¬¬ä¸€å€‹ Markdown Cell æä¾›äº†å®Œæ•´çš„æ“ä½œæŒ‡å—ã€‚
    *   åªéœ€åŸ·è¡Œ Notebook ä¸­çš„ Code Cell å³å¯å®Œæˆæ‰€æœ‰æ“ä½œï¼šç’°å¢ƒæ¸…ç†ã€å°ˆæ¡ˆä¸‹è¼‰ã€ä¾è³´å®‰è£ã€ä»¥åŠå•Ÿå‹• Streamlit æ‡‰ç”¨ç¨‹å¼ã€‚
    *   æ­¤ Notebook è¨­è¨ˆç‚º**ã€Œè¶…ç©©å¥ç‰ˆã€**ï¼Œèƒ½ç›´æ¥æ•ç²ä¸¦é¡¯ç¤º Streamlit æ‡‰ç”¨ç¨‹å¼çš„æ‰€æœ‰è¼¸å‡ºï¼ŒåŒ…æ‹¬å•Ÿå‹•æ™‚çš„éŒ¯èª¤è¿½è¹¤ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½å•é¡Œã€‚
    *   `run_in_colab.ipynb` Notebook ä¸­ä¹ŸåŒ…å«äº†ä¸€å€‹å¯é¸çš„æ­¥é©Ÿæ¥åŸ·è¡Œç¶œåˆå¥åº·åº¦æª¢æ¸¬ï¼Œè©³è¦‹ä¸‹æ–‡ã€ŒğŸ”§ ç¶œåˆå¥åº·åº¦æª¢æ¸¬ã€ç« ç¯€ã€‚

### æ–¹æ³•äºŒï¼šæ‰‹å‹•è¤‡è£½è²¼ä¸Šå–®ä¸€å„²å­˜æ ¼è…³æœ¬ (å‚™ç”¨)

å¦‚æœæ‚¨å¸Œæœ›ç›´æ¥åœ¨ä¸€å€‹æ–°çš„æˆ–ç¾æœ‰çš„ Colab Notebook ä¸­å¿«é€Ÿå•Ÿå‹•ï¼Œå¯ä»¥è¤‡è£½ä¸‹æ–¹çš„å®Œæ•´è…³æœ¬å…§å®¹ï¼Œä¸¦å°‡å…¶è²¼åˆ° Colab çš„ä¸€å€‹ç¨‹å¼ç¢¼å„²å­˜æ ¼ä¸­åŸ·è¡Œã€‚

**è«‹æ³¨æ„**ï¼šæ­¤è™•çš„è…³æœ¬èˆ‡ `run_in_colab.ipynb` ä¸­çš„ Code Cell å…§å®¹æ˜¯ç›¸åŒçš„ã€‚ä½¿ç”¨ `.ipynb` æª”æ¡ˆèƒ½æ›´å¥½åœ°ç®¡ç†è…³æœ¬çš„ç‰ˆæœ¬ã€‚

```python
#@title ğŸš€ ä¸€éµå•Ÿå‹• Wolf_V5 (ä¿®æ­£ç‰ˆ)
# === Wolf_V5 å°ˆæ¡ˆï¼šç’°å¢ƒè¨­ç½®ã€éƒ¨ç½²ã€å•Ÿå‹•èˆ‡å³æ™‚ç›£æ§ (å–®ä¸€å„²å­˜æ ¼) ===
# æ­¤ç‰ˆæœ¬å·²ä¿®æ­£å…¬é–‹å„²å­˜åº«çš„ git clone å•é¡Œï¼Œä¸¦æ•´åˆäº†æ—¥èªŒè·¯å¾‘ã€‚

import os
import subprocess
import time
import threading
from IPython.display import display, HTML, clear_output

# æª¢æŸ¥æ˜¯å¦åœ¨ Colab ç’°å¢ƒ
try:
    from google.colab import drive
    from google.colab.output import eval_js
    IN_COLAB = True
except ImportError:
    IN_COLAB = False
    # å¦‚æœéœ€è¦åœ¨æœ¬åœ°æ¨¡æ“¬ï¼Œå®šç¾© mock å‡½æ•¸
    def mock_drive_mount(path, force_remount=False): print(f"Mock: Drive mount requested for {path}")
    drive = type('Drive', (object,), {'mount': mock_drive_mount})()
    def mock_eval_js(code): print(f"Mock: eval_js called with {code}"); return "http://localhost:8501"
    eval_js = mock_eval_js
    print("é Colab ç’°å¢ƒï¼Œéƒ¨åˆ† Colab ç‰¹å®šåŠŸèƒ½å°‡è¢«æ¨¡æ“¬æˆ–è·³éã€‚")


# --- éšæ®µä¸€ï¼šç’°å¢ƒè¨­ç½®èˆ‡å°ˆæ¡ˆéƒ¨ç½² ---
print("--- éšæ®µä¸€ï¼šç’°å¢ƒè¨­ç½®èˆ‡å°ˆæ¡ˆéƒ¨ç½² ---")
print("\n[1/5] æ­£åœ¨å®‰è£å¿…è¦çš„ Python å¥—ä»¶...")
# ä½¿ç”¨ get_ipython() ä¾†åŸ·è¡Œ shell å‘½ä»¤
get_ipython().system('pip install streamlit google-generativeai yfinance pandas fredapi requests -q')
print("âœ… å¥—ä»¶å®‰è£å®Œæˆï¼")

GDRIVE_PROJECT_DIR = "/content/drive/MyDrive/wolfAI" # Google Drive ä¸­çš„å°ˆæ¡ˆè·¯å¾‘
LOCAL_PROJECT_DIR = "/content/wolfAI" # æœ¬åœ° Colab å„²å­˜çš„å°ˆæ¡ˆè·¯å¾‘
PROJECT_DIR_TO_USE = None # å¯¦éš›ä½¿ç”¨çš„å°ˆæ¡ˆç›®éŒ„

if IN_COLAB:
    print("\n[2/5] æ­£åœ¨å˜—è©¦æ›è¼‰ Google Drive...")
    try:
        drive.mount('/content/drive', force_remount=True)
        print("âœ… Google Drive æ›è¼‰æˆåŠŸï¼")
        PROJECT_DIR_TO_USE = GDRIVE_PROJECT_DIR

        # --- ç•¶ Drive æ›è¼‰æˆåŠŸæ™‚ï¼Œå‰µå»º Wolf_Data ç›®éŒ„çµæ§‹ ---
        WOLF_DATA_BASE_GDRIVE = "/content/drive/MyDrive/Wolf_Data"
        print(f"    æª¢æŸ¥/å‰µå»º Wolf_Data åŸºç¤ç›®éŒ„: {WOLF_DATA_BASE_GDRIVE}")
        if not os.path.exists(WOLF_DATA_BASE_GDRIVE):
            os.makedirs(WOLF_DATA_BASE_GDRIVE, exist_ok=True)
            print(f"    âœ… '{WOLF_DATA_BASE_GDRIVE}' å·²å‰µå»ºã€‚")
        else:
            print(f"    â¡ï¸ '{WOLF_DATA_BASE_GDRIVE}' å·²å­˜åœ¨ã€‚")

        sub_dirs_to_create = ["source_documents/masters", "source_documents/shan_jia_lang", "weekly_reports", "logs"]
        for sub_dir in sub_dirs_to_create:
            full_sub_dir_path = os.path.join(WOLF_DATA_BASE_GDRIVE, sub_dir)
            print(f"    æª¢æŸ¥/å‰µå»ºå­ç›®éŒ„: {full_sub_dir_path}")
            if not os.path.exists(full_sub_dir_path):
                os.makedirs(full_sub_dir_path, exist_ok=True)
                print(f"    âœ… '{full_sub_dir_path}' å·²å‰µå»ºã€‚")
            else:
                print(f"    â¡ï¸ '{full_sub_dir_path}' å·²å­˜åœ¨ã€‚")

    except Exception as e:
        print(f"âš ï¸ Google Drive æ›è¼‰å¤±æ•—: {e}")
        print("å°‡å˜—è©¦ä½¿ç”¨ Colab æœ¬åœ°å„²å­˜ç©ºé–“ã€‚")
        PROJECT_DIR_TO_USE = LOCAL_PROJECT_DIR
else:
    print("\n[2/5] è·³é Google Drive æ›è¼‰ (é Colab ç’°å¢ƒ)ã€‚")
    PROJECT_DIR_TO_USE = LOCAL_PROJECT_DIR

# è¨­å®šæ‡‰ç”¨ç¨‹å¼é æœŸçš„æ—¥èªŒç›®éŒ„è·¯å¾‘
WOLF_DATA_GDRIVE_BASE_INFO = "/content/drive/MyDrive/Wolf_Data"
WOLF_DATA_LOCAL_BASE_INFO = "/content/Wolf_Data"
APP_EXPECTED_LOG_DIR = None

if PROJECT_DIR_TO_USE == GDRIVE_PROJECT_DIR:
    APP_EXPECTED_LOG_DIR = os.path.join(WOLF_DATA_GDRIVE_BASE_INFO, "logs")
else:
    APP_EXPECTED_LOG_DIR = os.path.join(WOLF_DATA_LOCAL_BASE_INFO, "logs")
    if not os.path.exists(WOLF_DATA_LOCAL_BASE_INFO):
        os.makedirs(WOLF_DATA_LOCAL_BASE_INFO, exist_ok=True)
        print(f"    âœ… å·²ç¢ºèª/å»ºç«‹æ¨¡æ“¬çš„æœ¬åœ° Wolf_Data åŸºç¤ç›®éŒ„: {WOLF_DATA_LOCAL_BASE_INFO}")

print(f"\n[3/5] è¨­å®šå°ˆæ¡ˆè·¯å¾‘: {PROJECT_DIR_TO_USE}")
print(f"    æ‡‰ç”¨ç¨‹å¼è³‡æ–™/æ—¥èªŒç›®éŒ„é æœŸåœ¨: {APP_EXPECTED_LOG_DIR} (å¯¦éš›è·¯å¾‘ç”± app.py è¨­å®š)")

# å¼·åˆ¶æ¸…ç†èˆŠçš„å°ˆæ¡ˆç›®éŒ„
if os.path.exists(PROJECT_DIR_TO_USE):
    print(f"    åµæ¸¬åˆ°å·²å­˜åœ¨çš„å°ˆæ¡ˆç›®éŒ„ '{PROJECT_DIR_TO_USE}'ã€‚åŸ·è¡Œå¼·åˆ¶æ¸…ç†...")
    import shutil
    shutil.rmtree(PROJECT_DIR_TO_USE)
    print(f"    âœ… '{PROJECT_DIR_TO_USE}' å·²æˆåŠŸåˆªé™¤ã€‚")
else:
    print(f"    '{PROJECT_DIR_TO_USE}' ä¸å­˜åœ¨ï¼Œç„¡éœ€æ¸…ç†ã€‚")

project_parent_dir = os.path.dirname(PROJECT_DIR_TO_USE)
if not os.path.exists(project_parent_dir) and PROJECT_DIR_TO_USE != LOCAL_PROJECT_DIR:
     os.makedirs(project_parent_dir, exist_ok=True)

STREAMLIT_APP_PATH = os.path.join(PROJECT_DIR_TO_USE, "app.py")
REQUIREMENTS_PATH = os.path.join(PROJECT_DIR_TO_USE, "requirements.txt")
PORT = 8501

print(f"âœ… å·²ç¢ºèª/å»ºç«‹å°ˆæ¡ˆç›®éŒ„ã€‚")

# --- [å·²ä¿®æ­£] å¾ GitHub ç²å–ç¨‹å¼ç¢¼ ---
print(f"\n[4/5] æ­£åœ¨å¾ GitHub ç²å–æœ€æ–°ç¨‹å¼ç¢¼...")
GIT_REPO_URL = "https://github.com/hsp1234-web/Ai_wolf.git"

git_clone_command = ["git", "clone", "--depth", "1", GIT_REPO_URL, PROJECT_DIR_TO_USE]

# å»ºç«‹ä¸€å€‹æ–°çš„ç’°å¢ƒè®Šæ•¸ï¼Œå‘Šè¨´ Git ä¸è¦é€²è¡Œäº’å‹•å¼æå•
git_env = os.environ.copy()
git_env["GIT_TERMINAL_PROMPT"] = "0"

# ä½¿ç”¨æ–°çš„ç’°å¢ƒè®Šæ•¸ä¾†åŸ·è¡Œ git clone
result = subprocess.run(git_clone_command, capture_output=True, text=True, env=git_env)

if result.returncode == 0:
    print("    âœ… å°ˆæ¡ˆå…‹éš†å®Œæˆï¼")
else:
    print(f"    âŒ å°ˆæ¡ˆå…‹éš†å¤±æ•—:")
    print(result.stdout)
    print(result.stderr)
    raise SystemExit("Git clone å¤±æ•—ï¼Œçµ‚æ­¢åŸ·è¡Œã€‚")

# ä½¿ç”¨ requirements.txt å®‰è£ä¾è³´
if os.path.isfile(REQUIREMENTS_PATH):
    print("    æ­£åœ¨å¾ requirements.txt å®‰è£ä¾è³´...")
    pip_install_command = ["pip", "install", "-q", "-r", REQUIREMENTS_PATH]
    result_pip = subprocess.run(pip_install_command, capture_output=True, text=True)
    if result_pip.returncode == 0:
        print("    âœ… ä¾è³´å®‰è£å®Œæˆï¼")
    else:
        print(f"    âŒ ä¾è³´å®‰è£å¤±æ•—:")
        print(result_pip.stdout)
        print(result_pip.stderr)
else:
    print(f"    âš ï¸ è­¦å‘Š: æœªæ‰¾åˆ° requirements.txtã€‚")


print(f"\n[5/5] æª¢æŸ¥ä¸»è¦æ‡‰ç”¨ç¨‹å¼æª”æ¡ˆ...")
if not os.path.isfile(STREAMLIT_APP_PATH):
    raise SystemExit(f"âŒ éŒ¯èª¤ï¼šæœªåœ¨ {PROJECT_DIR_TO_USE} ä¸­æ‰¾åˆ° app.pyï¼")
print(f"âœ… æˆåŠŸæ‰¾åˆ°ä¸»è¦æ‡‰ç”¨ç¨‹å¼æª”æ¡ˆ: {STREAMLIT_APP_PATH}")
print("\n--- ç’°å¢ƒè¨­ç½®èˆ‡å°ˆæ¡ˆéƒ¨ç½²éšæ®µå®Œæˆ ---\n")
time.sleep(2)
if IN_COLAB: clear_output(wait=True)

# --- éšæ®µäºŒï¼šå•Ÿå‹• Streamlit ä¸¦ç›´æ¥ç›£æ§å…¶è¼¸å‡º ---
print("--- éšæ®µäºŒï¼šå•Ÿå‹• Streamlit ä¸¦ç›´æ¥ç›£æ§å…¶è¼¸å‡º ---")
streamlit_process = None
monitor_thread = None
tunnel_url = None

try:
    import sys
    cmd_streamlit = [sys.executable, "-m", "streamlit", "run", STREAMLIT_APP_PATH, "--server.port", str(PORT), "--server.headless", "true", "--server.enableCORS", "false", "--server.enableXsrfProtection", "false"]

    # å°‡ stderr é‡å®šå‘åˆ° stdoutï¼Œä»¥ä¾¿æ•ç²æ‰€æœ‰è¼¸å‡ºï¼ŒåŒ…æ‹¬éŒ¯èª¤
    streamlit_process = subprocess.Popen(cmd_streamlit, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, text=True, encoding='utf-8', cwd=PROJECT_DIR_TO_USE)
    print("âœ… Streamlit å•Ÿå‹•æŒ‡ä»¤å·²é€å‡ºã€‚")
    print("â³ ç­‰å¾…ä¼ºæœå™¨åˆå§‹åŒ–ä¸¦å˜—è©¦ç²å–é€£çµ...")

    def stream_watcher(identifier, stream):
        for line in iter(stream.readline, ''):
            if not line:
                break
            print(f"[{identifier}] {line}", end='', flush=True)
        stream.close()

    monitor_thread = threading.Thread(target=stream_watcher, args=('Streamlit', streamlit_process.stdout))
    monitor_thread.daemon = True # è¨­ç½®ç‚ºå®ˆè­·ç·šç¨‹
    monitor_thread.start()

    if IN_COLAB:
        print("\nâœ… ä¼ºæœå™¨å·²åœ¨èƒŒæ™¯å•Ÿå‹•ã€‚")
        print("   è«‹ç­‰å¾…ç´„ 15-30 ç§’è®“æœå‹™å®Œæˆåˆå§‹åŒ–...")
        try:
            input("   åˆå§‹åŒ–å®Œæˆå¾Œï¼Œè«‹æŒ‰ Enter éµå˜—è©¦ç²å–æ‡‰ç”¨ç¨‹å¼ç¶²å€...")
        except Exception:
            print("\nâš ï¸ è®€å–ç”¨æˆ¶è¼¸å…¥æ™‚ç™¼ç”ŸéŒ¯èª¤ã€‚å°‡ç¹¼çºŒå˜—è©¦ç²å–URLã€‚")

        # å¸¶æœ‰é‡è©¦æ©Ÿåˆ¶çš„ URL ç²å–
        print("\nğŸ”— é–‹å§‹å˜—è©¦ç²å–æ‡‰ç”¨ç¨‹å¼ç¶²å€...")
        MAX_RETRIES = 5
        RETRY_DELAY_SECONDS = 5
        for attempt in range(MAX_RETRIES):
            print(f"   ç¬¬ {attempt + 1}/{MAX_RETRIES} æ¬¡å˜—è©¦...")
            try:
                proxy_url_eval = eval_js(f'google.colab.kernel.proxyPort({PORT})', timeout_sec=10)
                if proxy_url_eval:
                    tunnel_url = proxy_url_eval
                    print(f"   ğŸ‰ æˆåŠŸç²å– Colab ä»£ç† URL: {tunnel_url}")
                    break
                else:
                    print(f"   âš ï¸ ç¬¬ {attempt + 1} æ¬¡å˜—è©¦ï¼ševal_js æœªè¿”å›æœ‰æ•ˆ URLã€‚")
            except Exception as e:
                print(f"   âš ï¸ ç¬¬ {attempt + 1} æ¬¡å˜—è©¦ç²å– URL æ™‚ç™¼ç”ŸéŒ¯èª¤: {e}")
            if attempt < MAX_RETRIES - 1:
                print(f"   å°‡åœ¨ {RETRY_DELAY_SECONDS} ç§’å¾Œé‡è©¦...")
                time.sleep(RETRY_DELAY_SECONDS)
            else:
                print(f"   âŒ é”åˆ°æœ€å¤§é‡è©¦æ¬¡æ•¸ï¼Œä»æœªèƒ½é€é eval_js ç²å–ç¶²å€ã€‚")

    if IN_COLAB: clear_output(wait=True)

    if tunnel_url:
        display(HTML(f"""
            <div style='border: 2px solid #4CAF50; padding: 20px; border-radius: 10px;'>
                <h2 style='color: #2E7D32;'>ğŸ‰ æ‡‰ç”¨ç¨‹å¼å·²æˆåŠŸå•Ÿå‹•ï¼</h2>
                <p>æ—¥èªŒå’ŒéŒ¯èª¤å°‡ç›´æ¥é¡¯ç¤ºåœ¨æœ¬å„²å­˜æ ¼çš„ä¸‹æ–¹ã€‚</p>
                <p><a href='{tunnel_url}' target='_blank' style='padding:12px 25px; background-color:#4CAF50; color:white; text-decoration:none; border-radius:8px;'>
                   ğŸš€ é»æ­¤é–‹å•Ÿ Wolf_V5 æ‡‰ç”¨ç¨‹å¼
                </a></p>
                <p style='font-size:0.8em; color:grey;'>å¦‚æœç„¡æ³•è¨ªå•ï¼Œè«‹æª¢æŸ¥ä¸‹æ–¹ Streamlit è¼¸å‡ºæ—¥èªŒã€‚</p>
            </div>
        """))
    else:
        display(HTML("<p style='color:red;'>âŒ æœªèƒ½ç²å–æ‡‰ç”¨ç¨‹å¼çš„å…¬é–‹è¨ªå• URLã€‚è«‹æª¢æŸ¥ä¸Šæ–¹çš„æ—¥èªŒè¼¸å‡ºä»¥äº†è§£è©³ç´°åŸå› ã€‚</p>"))

    print("\n--- æ‡‰ç”¨ç¨‹å¼å³æ™‚è¼¸å‡º (åŒ…å«æ—¥èªŒèˆ‡éŒ¯èª¤) ---")
    monitor_thread.join()

except KeyboardInterrupt:
    print("\n\nâŒ¨ï¸ åµæ¸¬åˆ°æ‰‹å‹•ä¸­æ–·ã€‚")
except Exception as e:
    print(f"\n\nâŒ è…³æœ¬åŸ·è¡ŒæœŸé–“ç™¼ç”ŸéŒ¯èª¤: {e}")
    import traceback
    traceback.print_exc()
finally:
    print("\n\n--- æ­£åœ¨çµ‚æ­¢ Streamlit æœå‹™ ---")
    if streamlit_process and streamlit_process.poll() is None:
        streamlit_process.terminate()
        try:
            streamlit_process.wait(timeout=10)
            print("    Streamlit ç¨‹åºå·²çµ‚æ­¢ã€‚")
        except subprocess.TimeoutExpired:
            print("    Streamlit ç¨‹åºæœªèƒ½å„ªé›…çµ‚æ­¢ï¼Œå¼·åˆ¶çµæŸã€‚")
            streamlit_process.kill()
    if monitor_thread and monitor_thread.is_alive():
        monitor_thread.join(timeout=5)
    print("--- è…³æœ¬åŸ·è¡Œå®Œç•¢ ---")
```

**åŸ·è¡Œèªªæ˜ï¼š**
*   ä¸Šè¿°è…³æœ¬æœƒå…ˆå®Œæˆç’°å¢ƒè¨­ç½®å’Œå°ˆæ¡ˆéƒ¨ç½²ï¼Œç„¶å¾Œè‡ªå‹•å•Ÿå‹• Streamlit æ‡‰ç”¨ç¨‹å¼ã€‚
*   æˆåŠŸå•Ÿå‹•å¾Œï¼Œæœƒé¡¯ç¤ºä¸€å€‹**ç¶ è‰²çš„ã€Œé»æ­¤é–‹å•Ÿ Wolf_V5 æ‡‰ç”¨ç¨‹å¼ã€æŒ‰éˆ•**ã€‚
*   æˆåŠŸå•Ÿå‹•å¾Œï¼Œæœƒé¡¯ç¤ºä¸€å€‹**ç¶ è‰²èƒŒæ™¯çš„ã€Œé»æ­¤é–‹å•Ÿ Wolf_V5 æ‡‰ç”¨ç¨‹å¼ã€å¤§æŒ‰éˆ•**ã€‚
*   å„²å­˜æ ¼çš„è¼¸å‡ºå€åŸŸå°‡æŒçºŒé¡¯ç¤ºæ‡‰ç”¨ç¨‹å¼çš„å³æ™‚æ—¥èªŒã€‚
*   è¦åœæ­¢ Streamlit æœå‹™ï¼Œè«‹**æ‰‹å‹•ä¸­æ–·æ­¤å„²å­˜æ ¼çš„åŸ·è¡Œ** (ä¾‹å¦‚ï¼Œé»æ“Šå„²å­˜æ ¼å·¦å´çš„åœæ­¢æŒ‰éˆ•ï¼Œæˆ–ä½¿ç”¨å¿«æ·éµ `Ctrl+M I`)ã€‚

---
## ğŸ”§ ç¶œåˆå¥åº·åº¦æª¢æ¸¬

æœ¬å°ˆæ¡ˆæä¾›äº†ä¸€å€‹å¼·å¤§çš„ç¶œåˆå¥åº·åº¦æª¢æ¸¬è…³æœ¬ (`health_check_script_final.py`)ï¼Œç”¨æ–¼å…¨é¢è‡ªå‹•åŒ–åœ°æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼çš„å…§å¤–éƒ¨ç’°å¢ƒã€ä¾è³´å¥—ä»¶ã€API é€£æ¥ã€å‰å¾Œç«¯æœå‹™å•Ÿå‹•ä»¥åŠæ ¸å¿ƒåŠŸèƒ½çš„æ­£ç¢ºæ€§ã€‚

**æ­¤æª¢æ¸¬ç‰¹åˆ¥é©ç”¨æ–¼ï¼š**
*   **é–‹ç™¼è€…**ï¼šåœ¨ä¿®æ”¹ç¨‹å¼ç¢¼å¾Œï¼Œå¿«é€Ÿé©—è­‰æ‰€æœ‰é—œéµéƒ¨åˆ†æ˜¯å¦ä»èƒ½æ­£å¸¸é‹ä½œã€‚
*   **å°ˆæ¡ˆç¶­è­·è€…**ï¼šå®šæœŸæª¢æŸ¥å°ˆæ¡ˆçš„å¥åº·ç‹€æ³ï¼Œç¢ºä¿å¤–éƒ¨ API å’Œç’°å¢ƒä¾è³´æœªç™¼ç”Ÿéé æœŸçš„è®ŠåŒ–ã€‚
*   **å•é¡Œæ’æŸ¥**ï¼šç•¶æ‡‰ç”¨ç¨‹å¼é‡åˆ°é æœŸå¤–çš„è¡Œç‚ºæˆ–éŒ¯èª¤æ™‚ï¼Œæä¾›è©³ç´°çš„éŒ¯èª¤å ±å‘Šä»¥è¼”åŠ©å®šä½å•é¡Œã€‚

**æª¢æ¸¬ç¯„åœåŒ…æ‹¬ï¼š**
*   Colab ç’°å¢ƒé…ç½®ï¼ˆPython ç‰ˆæœ¬ã€ç¡¬é«”è³‡æºç­‰ï¼‰ã€‚
*   å°ˆæ¡ˆæª”æ¡ˆçµæ§‹èˆ‡ä¾è³´å®‰è£ã€‚
*   API é‡‘é‘°è®€å–ï¼ˆéœ€åœ¨ Colab Secrets ä¸­é å…ˆè¨­å®šï¼Œè©³è¦‹ä¸‹æ–¹èªªæ˜ï¼‰åŠå¤–éƒ¨æœå‹™ï¼ˆå¦‚ Google Gemini, FREDï¼‰çš„é€£é€šæ€§ã€‚
*   å¾Œç«¯ FastAPI æœå‹™çš„å•Ÿå‹•ã€è³‡æ–™åº«åˆå§‹åŒ–åŠæ ¸å¿ƒ API ç«¯é»æ¸¬è©¦ï¼ˆåŒ…æ‹¬èªè­‰ã€èŠå¤©ã€è³‡æ–™ç²å–ã€æª”æ¡ˆä¸Šå‚³ã€è³‡æ–™åº«å‚™ä»½ç­‰ï¼‰ã€‚
*   å‰ç«¯ Streamlit æ‡‰ç”¨çš„å•Ÿå‹•åˆæ­¥æª¢æŸ¥ã€‚
*   åŸ·è¡Œå°ˆæ¡ˆè‡ªå¸¶çš„ Pytest å–®å…ƒæ¸¬è©¦ã€‚

**å¦‚ä½•åŸ·è¡Œå¥åº·æª¢æ¸¬ï¼š**

æˆ‘å€‘æä¾›äº†å…©ç¨®ä¸»è¦æ–¹å¼ä¾†åŸ·è¡Œæ­¤å¥åº·æª¢æ¸¬ï¼š

### æ–¹æ³•ä¸€ï¼šé€šé `run_in_colab.ipynb` Notebook ä¸­çš„å°ˆç”¨å„²å­˜æ ¼ (æ¨è–¦)

é€™æ˜¯åŸ·è¡Œå¥åº·æª¢æ¸¬çš„**æ¨è–¦æ–¹æ³•**ï¼Œå› ç‚ºå®ƒç›´æ¥æ•´åˆåœ¨ä¸»è¦çš„ Colab å•Ÿå‹• Notebook ä¸­ï¼Œæ–¹ä¾¿æ˜“ç”¨ã€‚

1.  **æ‰“é–‹ `run_in_colab.ipynb` Notebook**ï¼š
    [![åœ¨ Colab ä¸­æ‰“é–‹](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/hsp1234-web/Ai_wolf/blob/main/run_in_colab.ipynb)
2.  **åŸ·è¡Œä¸»æ‡‰ç”¨éƒ¨ç½²å„²å­˜æ ¼**ï¼šç¢ºä¿ `run_in_colab.ipynb` ä¸­æ¨™é¡Œé¡ä¼¼ã€ŒğŸš€ ä¸€éµå•Ÿå‹• Wolf_V5ã€æˆ–ã€Œ1. ç’°å¢ƒè¨­ç½®èˆ‡å°ˆæ¡ˆéƒ¨ç½²ã€çš„å„²å­˜æ ¼å·²æˆåŠŸåŸ·è¡Œï¼Œé€™æ¨£å°ˆæ¡ˆç¨‹å¼ç¢¼ï¼ˆåŒ…æ‹¬ `health_check_script_final.py`ï¼‰æ‰æœƒè¢«æ­£ç¢ºä¸‹è¼‰åˆ° Colab ç’°å¢ƒä¸­ã€‚
3.  **æ‰¾åˆ°ä¸¦åŸ·è¡Œå¥åº·æª¢æ¸¬å„²å­˜æ ¼**ï¼š
    *   åœ¨ `run_in_colab.ipynb` Notebook ä¸­ï¼Œæ‰¾åˆ°æ¨™é¡Œç‚ºã€Œâš™ï¸ (å¯é¸) åŸ·è¡Œç¶œåˆå¥åº·åº¦æª¢æ¸¬ã€çš„ç¨‹å¼ç¢¼å„²å­˜æ ¼ã€‚
    *   åŸ·è¡Œæ­¤å„²å­˜æ ¼ã€‚
4.  **æŸ¥çœ‹å ±å‘Š**ï¼š
    *   è…³æœ¬åŸ·è¡Œéç¨‹å¯èƒ½éœ€è¦ 1-3 åˆ†é˜ã€‚
    *   å®Œæˆå¾Œï¼Œä¸€ä»½è©³ç´°çš„ HTML æ ¼å¼æª¢æ¸¬å ±å‘Šå°‡ç›´æ¥é¡¯ç¤ºåœ¨è©²å„²å­˜æ ¼çš„è¼¸å‡ºå€åŸŸã€‚

### æ–¹æ³•äºŒï¼šæ‰‹å‹•è¤‡è£½ä¸¦åŸ·è¡Œè…³æœ¬ (å‚™ç”¨)

å¦‚æœæ‚¨éœ€è¦åœ¨ä¸€å€‹æ–°çš„ Colab Notebook ä¸­æˆ–ä»¥å…¶ä»–æ–¹å¼ç¨ç«‹åŸ·è¡Œæª¢æ¸¬ï¼š

1.  **ç²å–è…³æœ¬**ï¼šç¢ºä¿æ‚¨çš„å°ˆæ¡ˆå·²å…‹éš†åˆ° Colab ç’°å¢ƒã€‚æ‰¾åˆ°ä½æ–¼å°ˆæ¡ˆæ ¹ç›®éŒ„ä¸‹çš„ `health_check_script_final.py` æª”æ¡ˆã€‚
2.  **è¤‡è£½å…§å®¹**ï¼šæ‰“é–‹ `health_check_script_final.py` ä¸¦è¤‡è£½å…¶å®Œæ•´çš„ Python ç¨‹å¼ç¢¼ã€‚
3.  **è²¼ä¸Šä¸¦åŸ·è¡Œ**ï¼šåœ¨æ‚¨çš„ Colab Notebook ä¸­å‰µå»ºä¸€å€‹æ–°çš„ç¨‹å¼ç¢¼å„²å­˜æ ¼ï¼Œå°‡è¤‡è£½çš„è…³æœ¬å…§å®¹è²¼å…¥ï¼Œç„¶å¾ŒåŸ·è¡Œè©²å„²å­˜æ ¼ã€‚
4.  **æŸ¥çœ‹å ±å‘Š**ï¼šåŸ·è¡Œå®Œç•¢å¾Œï¼ŒHTML å ±å‘ŠåŒæ¨£æœƒé¡¯ç¤ºåœ¨è¼¸å‡ºå€åŸŸã€‚

**API é‡‘é‘°é…ç½®æç¤º (é‡è¦)ï¼š**
ç‚ºäº†ä½¿å¥åº·æª¢æ¸¬è…³æœ¬èƒ½å¤ å…¨é¢æ¸¬è©¦ API é‡‘é‘°çš„è®€å–å’Œå¤–éƒ¨æœå‹™çš„é€£é€šæ€§ (ä¾‹å¦‚ Google Gemini API, FRED API)ï¼Œæ‚¨**å¿…é ˆ**åœ¨ Colab çš„ã€Œå¯†é‘°ã€(Secrets Manager) ä¸­é å…ˆè¨­å®šå¥½ä»¥ä¸‹åç¨±çš„å¯†é‘°åŠå…¶å°æ‡‰å€¼ï¼š
*   `GEMINI_API_KEY`: æ‚¨çš„ Google Gemini API é‡‘é‘°ã€‚(æ­¤é‡‘é‘°ä¸»è¦ç”±ä¸»æ‡‰ç”¨ç¨‹å¼ä½¿ç”¨ï¼Œå¥åº·æª¢æŸ¥è…³æœ¬å…§éƒ¨çš„æ¨¡æ“¬è®€å–æœƒæ¸¬è©¦å…¶å­˜åœ¨æ€§)
*   `COLAB_GOOGLE_API_KEY_FOR_TEST`: æ‚¨çš„ Google Gemini API é‡‘é‘°ã€‚(å¥åº·æª¢æŸ¥è…³æœ¬æœƒä½¿ç”¨æ­¤é‡‘é‘°**ç›´æ¥æ¸¬è©¦**å° Google GenAI æœå‹™çš„é€£é€šæ€§)
*   `COLAB_FRED_API_KEY_FOR_TEST`: æ‚¨çš„ FRED API é‡‘é‘°ã€‚(å¥åº·æª¢æŸ¥è…³æœ¬æœƒä½¿ç”¨æ­¤é‡‘é‘°**ç›´æ¥æ¸¬è©¦**å° FRED æœå‹™çš„é€£é€šæ€§)
å¦‚æœæœªè¨­å®šé€™äº›å¯†é‘°ï¼Œç›¸é—œçš„ API é€£é€šæ€§æ¸¬è©¦å°‡æœƒè¢«æ¨™è¨˜ç‚ºè­¦å‘Š (WARN) æˆ–è·³é (SKIPPED)ï¼Œä½†å…¶ä»–ä¸ä¾è³´é€™äº›é‡‘é‘°çš„æª¢æ¸¬ä»æœƒåŸ·è¡Œã€‚

---

### æ‡‰ç”¨ç¨‹å¼æ“ä½œæŒ‡å—

1.  **è¨­å®š Gemini API Key (é‡è¦)ï¼š**
    *   æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å¾Œï¼Œè«‹åœ¨å´é‚Šæ¬„çš„ "API è¨­å®š" å€åŸŸè¼¸å…¥æ‚¨çš„ Gemini API Keyã€‚å„ªå…ˆæ¨è–¦ä½¿ç”¨ Colab Secrets Manager (è©³è¦‹ä¸‹æ–¹é™„éŒ„ A)ã€‚`app.py` å·²è¨­è¨ˆç‚ºå„ªå…ˆå¾ Colab Secrets (åç¨± `GEMINI_API_KEY`) åŠ è¼‰é‡‘é‘°ã€‚
    *   ç„¡æœ‰æ•ˆ API Keyï¼ŒAI åˆ†æåŠŸèƒ½ç„¡æ³•ä½¿ç”¨ã€‚

2.  **å¾ Google Drive è®€å–åˆ†ææ–‡ä»¶ï¼š**
    *   åœ¨å´é‚Šæ¬„ "è®€å– Google Drive æ–‡ä»¶" å€åŸŸï¼Œè¼¸å…¥æ‚¨æƒ³åˆ†æçš„ã€å­˜æ–¼æ‚¨ Google Drive `My Drive` ä¸‹çš„**ç›¸å°æ–¼ `My Drive` çš„æ–‡ä»¶è·¯å¾‘** (ä¾‹å¦‚ `wolfAI/my_report.txt` æˆ– `Colab_Data/another_report.txt`)ã€‚
    *   **æ—¥æœŸè§£ææç¤ºï¼š** ç‚ºäº†è®“ AI èƒ½æ›´å¥½åœ°é€²è¡Œå¸‚å ´å›é¡§ï¼Œå»ºè­°æ‚¨çš„æ–‡æœ¬æ–‡ä»¶å…§å®¹ä¸­åŒ…å«æ˜ç¢ºçš„æ—¥æœŸæ¨™è­˜ï¼Œæ ¼å¼ç‚º `æ—¥æœŸï¼šYYYY-MM-DD`ã€‚æ‡‰ç”¨ç¨‹å¼æœƒå˜—è©¦å¾æ­¤æ¨™è­˜è§£æåŸºæº–æ—¥æœŸã€‚
    *   é»æ“Š "è®€å–ä¸¦è¨­ç‚ºç•¶å‰åˆ†ææ–‡ä»¶"ã€‚

3.  **é€²è¡Œ AI åˆæ­¥åˆ†æ (åŒ…å«å¸‚å ´å›é¡§)ï¼š**
    *   æ–‡ä»¶æˆåŠŸè®€å–å¾Œï¼Œä¸»èŠå¤©å€ä¸‹æ–¹æœƒå‡ºç¾ "AI åˆæ­¥åˆ†æ (åŒ…å«å¸‚å ´å›é¡§)" æŒ‰éˆ•ã€‚
    *   é»æ“Šæ­¤æŒ‰éˆ•ï¼š
        *   AI æœƒå°æ–‡æœ¬å…§å®¹é€²è¡Œæ‘˜è¦åˆ†æï¼ˆåŒ…æ‹¬ã€Œå–„ç”²ç‹¼ã€æ ¸å¿ƒè§€é»ç­‰ï¼‰ã€‚
        *   **å¸‚å ´å›é¡§ï¼š** AI æœƒå˜—è©¦æ ¹æ“šå¾æ–‡ä»¶ä¸­è§£æå‡ºçš„æ—¥æœŸï¼ˆè‹¥ç„¡å‰‡ä½¿ç”¨ç•¶å‰æ—¥æœŸï¼‰ï¼Œè‡ªå‹•ç²å–ä¸¦å±•ç¤ºå°ç£åŠ æ¬ŠæŒ‡æ•¸ (`^TWII`)ã€ç´æ–¯é”å…‹ç¶œåˆæŒ‡æ•¸ (`^IXIC`)ã€æ¨™æ™®500æŒ‡æ•¸ (`^GSPC`)ã€è²»åŸåŠå°é«”æŒ‡æ•¸ (`^SOX`)å’Œæ—¥ç¶“225æŒ‡æ•¸ (`^N225`) åœ¨è©²æ—¥æœŸå‰ä¸€é€±çš„**æ—¥ç·šèµ°å‹¢åœ–**å’Œ**æ•¸æ“šæ‘˜è¦**ã€‚é€™äº›åœ–è¡¨å’Œæ‘˜è¦å°‡ä½œç‚º AI åˆ†æçš„ä¸€éƒ¨åˆ†é¡¯ç¤ºåœ¨èŠå¤©å€ã€‚
        *   `yfinance` å¥—ä»¶ï¼ˆç”¨æ–¼ç²å–å¸‚å ´æ•¸æ“šï¼‰å·²åœ¨ Cell 1 ä¸­è‡ªå‹•å®‰è£ã€‚

4.  **èŠå¤©äº’å‹•ï¼š**
    *   æ‚¨å¯ä»¥åœ¨èŠå¤©å€åº•éƒ¨çš„è¼¸å…¥æ¡†ä¸­èˆ‡ AI é€²è¡Œå°è©±ã€‚é€²éšçš„èŠå¤©æŒ‡ä»¤åŠŸèƒ½ï¼ˆå¦‚æŸ¥è©¢ç‰¹å®šè‚¡ç¥¨æ•¸æ“šï¼‰æ­£åœ¨è¦åŠƒä¸­ã€‚

### æ³¨æ„äº‹é …
*   Colab Notebook éœ€ä¿æŒé‹è¡Œã€‚
*   ç’°å¢ƒé‡å•Ÿå¾Œéœ€é‡æ–°åŸ·è¡Œ Cell 1 å’Œ Cell 2ã€‚
*   ç¨‹å¼ç¢¼ä¸»è¦é€é GitHub æ›´æ–°ã€‚

---

## æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ (Viewing Application Logs)

æœ¬æ‡‰ç”¨ç¨‹å¼å…§å»ºäº†è©³ç´°çš„æ—¥èªŒè¨˜éŒ„åŠŸèƒ½ï¼Œä»¥å”åŠ©ä½¿ç”¨è€…å’Œé–‹ç™¼è€…è¿½è¹¤åŸ·è¡Œç‹€æ³åŠé€²è¡Œå•é¡Œæ’æŸ¥ã€‚

### å¦‚ä½•æŸ¥çœ‹æ—¥èªŒ

1.  **ä½ç½®**ï¼šåœ¨æ‡‰ç”¨ç¨‹å¼ä¸»é é¢çš„åº•éƒ¨ï¼Œä½ æœƒæ‰¾åˆ°ä¸€å€‹åç‚ºã€ŒğŸ“„ æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ (Application Logs)ã€çš„å¯å±•é–‹å€åŸŸã€‚
2.  **æ“ä½œ**ï¼šé»æ“Šè©²å€åŸŸå³å¯å±•é–‹ï¼ŒæŸ¥çœ‹å³æ™‚çš„æ‡‰ç”¨ç¨‹å¼æ—¥èªŒè¨Šæ¯ã€‚æ—¥èªŒæœƒé¡¯ç¤ºæœ€æ–°çš„äº‹ä»¶åœ¨æœ€ä¸Šæ–¹ã€‚
3.  **æ¸…é™¤æ—¥èªŒ**ï¼šåœ¨æ­¤å€åŸŸå…§é‚„æœ‰ä¸€å€‹ã€Œæ¸…é™¤æ—¥èªŒç´€éŒ„ã€æŒ‰éˆ•ï¼Œå¯ä»¥æ¸…é™¤ç•¶å‰é¡¯ç¤ºåœ¨ä»‹é¢ä¸­çš„æ—¥èªŒã€‚é€™ä¸æœƒå½±éŸ¿åˆ°ä¼ºæœå™¨æ§åˆ¶å°çš„æ—¥èªŒè¼¸å‡ºã€‚

### æ—¥èªŒç´šåˆ¥

æ—¥èªŒç´šåˆ¥é è¨­ç‚º `DEBUG`ã€‚é€™è¡¨ç¤ºæœƒè¨˜éŒ„éå¸¸è©³ç´°çš„æ‡‰ç”¨ç¨‹å¼åŸ·è¡Œä¿¡æ¯ï¼ŒåŒ…æ‹¬å‡½æ•¸èª¿ç”¨ã€è®Šæ•¸ç‹€æ…‹ã€API è«‹æ±‚èˆ‡å›æ‡‰ç­‰ã€‚é€™å°æ–¼æ·±å…¥äº†è§£æ‡‰ç”¨ç¨‹å¼çš„å…§éƒ¨é‹ä½œå’Œå¿«é€Ÿå®šä½å•é¡Œéå¸¸æœ‰å¹«åŠ©ã€‚

### æ—¥èªŒç”¨é€”

é€™äº›æ—¥èªŒä¸»è¦ç”¨æ–¼ï¼š
*   é–‹ç™¼è€…é€²è¡Œæ‡‰ç”¨ç¨‹å¼åµéŒ¯ã€‚
*   åœ¨é‡åˆ°é æœŸå¤–çš„è¡Œç‚ºæˆ–éŒ¯èª¤æ™‚ï¼Œæä¾›è©³ç´°çš„åŸ·è¡Œä¸Šä¸‹æ–‡ã€‚
*   å¹«åŠ©ç†è§£æ•¸æ“šè™•ç†å’Œ API äº’å‹•çš„æµç¨‹ã€‚

---
### é™„éŒ„ Aï¼šå®‰å…¨è¨­å®š Gemini API Key (æ¨è–¦)

(æ­¤éƒ¨åˆ†å…§å®¹èˆ‡ä¸Šä¸€ç‰ˆ README.md ç›¸åŒï¼Œä¿æŒä¸è®Š)
ç‚ºäº†æ›´å®‰å…¨å’ŒæŒä¹…åœ°ä½¿ç”¨ API Keyï¼Œå»ºè­°ä½¿ç”¨ Colab çš„ **Secrets Manager**ï¼š
1.  **åœ¨ Colab ä¸­æ·»åŠ å¯†é‘°ï¼š** å·¦å´é‘°åŒ™åœ–æ¨™ -> "+ æ–°å¢å¯†é‘°" -> åç¨± `GEMINI_API_KEY` -> è²¼ä¸Šé‡‘é‘°å€¼ -> å•Ÿç”¨ "ç­†è¨˜æœ¬è¨ªå•æ¬Šé™"ã€‚
2.  **æ‡‰ç”¨ç¨‹å¼ä¸­çš„è®€å–é‚è¼¯**ï¼šæ‡‰ç”¨ç¨‹å¼æœƒé€é `utils/session_state_manager.py` ä¸­çš„é‚è¼¯ï¼Œå„ªå…ˆå¾ Colab Secrets è®€å–åç‚º `GEMINI_API_KEY` çš„é‡‘é‘°ã€‚

---

# (English Content)

# Wolf_V5

## Project Goal
(Same as previous version)

## How to Run in Colab (New Two-Cell Process)
(Same as previous version, up to Prerequisites)

### Prerequisites
*   A valid Google account.
*   A Gemini API Key is recommended for full AI analysis features. Obtain one from [Google AI Studio](https://aistudio.google.com/app/apikey).

### Cell 1: Environment Setup and Project Deployment
Copy the entire script content below, paste it into the first code cell of your Colab Notebook, and then run this cell.
This cell will:
1.  Install necessary Python packages (`streamlit`, `google-generativeai`, `yfinance`, `pandas`).
2.  Mount your Google Drive.
3.  Create a `wolfAI` directory under `My Drive`.
4.  Clone/update the project code from GitHub (`https://github.com/hsp1234-web/Ai_wolf.git`) into `My Drive/wolfAI/`.

```python
#@title 1. Environment Setup & Ai_wolf Project Deployment (Click to expand code)
# === Colab Environment Setup & Ai_wolf Project Deployment ===
# Cell 1: Please run this cell to complete all initial setup.
import os

# --- 1. Install Necessary Python Packages ---
print("Installing necessary Python packages (streamlit, google-generativeai, yfinance, pandas)...")
!pip install streamlit google-generativeai yfinance pandas -q
# Added pandas because yfinance might need it, and it's also used in app.py
print("Package installation complete!\n")

# --- 2. Mount Google Drive ---
print("Attempting to mount Google Drive...")
from google.colab import drive
try:
    drive.mount('/content/drive', force_remount=True)
    print("Google Drive mounted successfully!\n")
except Exception as e:
    print(f"Failed to mount Google Drive: {e}")
    print("Please check the authorization steps in the pop-up window. If issues persist, try 'Runtime' -> 'Disconnect and delete runtime', then re-run this cell.") # Note: Colab-specific runtime management tip
    raise # Raise exception to stop execution if mounting fails

# --- 3. Define Project Path and Create Target Folder ---
# GDRIVE_PROJECT_DIR will be defined here, specifying the project directory in Google Drive
GDRIVE_PROJECT_DIR = "/content/drive/MyDrive/wolfAI"
print(f"Project will be deployed to Google Drive path: {GDRIVE_PROJECT_DIR}")
# Using !mkdir -p to execute a shell command to create the directory if it doesn't already exist
!mkdir -p "{GDRIVE_PROJECT_DIR}"
# åŒæ™‚å‰µå»ºæ—¥èªŒç›®éŒ„
!mkdir -p "{GDRIVE_PROJECT_DIR}/logs"
print(f"Project directory confirmed/created and logs directory created.\n")

# --- 4. Clone or Update Ai_wolf Project Code from GitHub ---
GIT_REPO_URL = "https://github.com/hsp1234-web/Ai_wolf.git"
GIT_DIR_CHECK = f"{GDRIVE_PROJECT_DIR}/.git" # Used to check if the .git directory exists, indicating a Git repository

print(f"Fetching latest code from {GIT_REPO_URL}...")
if os.path.isdir(GIT_DIR_CHECK): # Use os.path.isdir to check if the directory exists
    print("Existing project Git repository detected, attempting to update (git pull)...")
    import subprocess # Import subprocess module to execute shell commands
    # This is a more robust update method: first fetch and reset to the latest state of the remote main branch, then pull
    git_pull_command = f"cd '{GDRIVE_PROJECT_DIR}' && git fetch origin main && git reset --hard origin/main && git pull origin main"
    print(f"Executing update command: {git_pull_command}")
    process = subprocess.run(git_pull_command, shell=True, capture_output=True, text=True)
    if process.returncode == 0:
        print("Project update successful (git pull)!")
        if process.stdout: print(f"Git Pull Output:\n{process.stdout}")
        if process.stderr: print(f"Git Pull Error Messages (if any):\n{process.stderr}")
    else:
        print(f"git pull failed (return code: {process.returncode}). Error details:")
        print(process.stderr)
        print("This could be due to local merge conflicts or network issues. Consider manually deleting the 'wolfAI' directory in Google Drive and re-running this cell for a fresh clone.")
else:
    print(f"No existing .git repository found, cloning project from {GIT_REPO_URL} to {GDRIVE_PROJECT_DIR} ...")
    # Using !git clone to execute a shell command to clone the repository, --depth 1 for a shallow clone (latest commit only)
    !git clone --depth 1 "{GIT_REPO_URL}" "{GDRIVE_PROJECT_DIR}"
    print("Project cloning complete!")

print("\n--- 5. Verify Project Files ---")
print(f"Listing contents of {GDRIVE_PROJECT_DIR}:")
# Using !ls -la to execute a shell command to list file details (including hidden files)
!ls -la "{GDRIVE_PROJECT_DIR}"
APP_PY_PATH = f"{GDRIVE_PROJECT_DIR}/app.py" # Define the path to the main application file
# Check if the main app.py file exists
if os.path.isfile(APP_PY_PATH): # Use os.path.isfile to check if the file exists
    print(f"\nSuccessfully found the main application file: {APP_PY_PATH}")
    print("\nâœ… Cell 1 Setup Complete! You can now proceed to run Cell 2.")
else:
    print(f"\nâŒ Error: Main application file app.py not found in {GDRIVE_PROJECT_DIR}!")
    print(f"Please check if app.py exists in the GitHub repository ({GIT_REPO_URL}) at the root level or if there were errors in previous steps.")

```
**Execution Notes:**
*   Monitor Colab output.
*   **Google Drive Authorization:** Authorize when prompted.
*   **GitHub Updates:** The script attempts to pull the latest code.

### Cell 2: Launch the Streamlit Application and Monitor Logs
After Cell 1 executes successfully, copy the following into the second Colab cell and run it.
This cell will:
1. Launch the Streamlit application.
2. Attempt to fetch and display a publicly accessible Colab proxy URL.
3. **Remain running** to maintain the Streamlit service and will **output live application logs**.
4. You can stop the Streamlit service by **manually interrupting this cell (Interrupt execution)**.

```python
#@title 2. ğŸš€ Launch Wolf_V5 App, Get Link & Monitor Logs (Click to execute)
# === Wolf_V5 Project Launch, Link Retrieval & Log Monitoring ===
# Cell 2: Execute this cell to launch the Streamlit application, automatically fetch the access link, and continuously output logs.
#         You can manually interrupt this cell at any time to stop the service.

import subprocess
import time
import os
import threading # For monitoring the Streamlit process
from IPython.display import display, HTML, clear_output
from google.colab.output import eval_js

# --- Configuration Parameters ---
GDRIVE_PROJECT_DIR = "/content/drive/MyDrive/wolfAI" # Inherited from Cell 1 or redefined here
STREAMLIT_APP_PATH = f"{GDRIVE_PROJECT_DIR}/app.py"
LOG_DIR = f"{GDRIVE_PROJECT_DIR}/logs" # Log directory
LOG_FILE_PATH = f"{LOG_DIR}/streamlit.log" # Streamlit app should output logs here

PORT = 8501 # Port for the Streamlit app
WAIT_SECONDS_FOR_SERVER = 15
MAX_RETRIES_FOR_URL = 3
RETRY_DELAY_SECONDS = 5

# --- Clear Previous Output ---
# clear_output(wait=True) # Uncomment to clear previous output of this cell on each run

print("ğŸš€ Preparing to launch Streamlit application...")
print(f"   Application path: {STREAMLIT_APP_PATH}")
print(f"   Log file path: {LOG_FILE_PATH}")
print(f"   Expected listening port: {PORT}")
print("-" * 70)

# --- Check if app.py Exists ---
if not os.path.exists(STREAMLIT_APP_PATH):
    display(HTML(f"<p style='color:red; font-weight:bold;'>âŒ Error: Streamlit application file not found!</p>" \
                 f"<p style='color:red;'>   Please ensure the path <code style='color:red; background-color:#f0f0f0; padding:2px 4px; border-radius:3px;'>{STREAMLIT_APP_PATH}</code> is correct,</p>" \
                 f"<p style='color:red;'>   and that you have successfully executed all steps in Cell 1.</p>"))
    raise SystemExit("Application file app.py not found, terminating execution.")

# --- Ensure Log Directory and File Exist ---
os.makedirs(LOG_DIR, exist_ok=True)
with open(LOG_FILE_PATH, 'a') as f: # 'a' mode creates the file if it doesn't exist
    f.write(f"--- Colab script log monitoring started at {time.strftime('%Y-%m-%d %H:%M:%S')} ---\n")
print(f"Log file {LOG_FILE_PATH} confirmed/created.")
print("-" * 70)

# --- Launch Streamlit Server ---
streamlit_process = None
monitor_thread = None # Initialize monitor thread variable

try:
    print(f"â³ Attempting to launch Streamlit in the background (approx. {WAIT_SECONDS_FOR_SERVER} seconds)...")
    cmd = ["streamlit", "run", STREAMLIT_APP_PATH,
           "--server.port", str(PORT),
           "--server.headless", "true",
           "--browser.gatherUsageStats", "false"]

    streamlit_process = subprocess.Popen(cmd)

    print(f"   Streamlit launch command sent (PID: {streamlit_process.pid if streamlit_process else 'Unknown'}).")
    print(f"   Allowing server {WAIT_SECONDS_FOR_SERVER} seconds to initialize...")
    time.sleep(WAIT_SECONDS_FOR_SERVER)

    if streamlit_process.poll() is not None:
        display(HTML(f"<p style='color:red; font-weight:bold;'>âŒ Streamlit appears to have failed to start or terminated unexpectedly (return code: {streamlit_process.returncode}).</p>" \
                     f"<p style='color:orange;'>   Please check if `app.py` has syntax errors, or try checking Colab's 'Runtime' -> 'View runtime logs'.</p>" \
                     f"<p style='color:orange;'>   If your Streamlit application has internal logging (e.g., writing to {LOG_FILE_PATH}), that file might contain more clues.</p>"))
        raise SystemExit(f"Streamlit process failed to stay running (return code: {streamlit_process.returncode}).")

    print("âœ… Streamlit should now be running in the background.")
    print("-" * 70)

except Exception as e:
    display(HTML(f"<p style='color:red; font-weight:bold;'>âŒ An unexpected error occurred while launching Streamlit:</p>" \
                 f"<p style='color:red; font-family:monospace; white-space:pre-wrap;'>{str(e)}</p>" \
                 f"<p style='color:orange;'>   Please check the error message, ensure Streamlit is correctly installed, and paths are correct.</p>"))
    if streamlit_process and streamlit_process.poll() is None:
        streamlit_process.terminate()
    raise SystemExit(f"Failed to launch Streamlit: {str(e)}")

# --- Attempt to Get Colab Proxy URL ---
print("ğŸ”— Attempting to fetch Colab proxy access URL...")
proxy_url = None
for attempt in range(MAX_RETRIES_FOR_URL):
    print(f"   Attempt {attempt + 1}/{MAX_RETRIES_FOR_URL}...")
    try:
        proxy_url = eval_js(f'google.colab.kernel.proxyPort({PORT})')
        if proxy_url:
            print(f"   ğŸ‰ Successfully fetched proxy URL!")
            break
    except Exception as e_evaljs:
        print(f"      Failed to fetch URL on attempt {attempt + 1}: {str(e_evaljs)[:100]}...")
    if attempt < MAX_RETRIES_FOR_URL - 1:
        print(f"      Waiting {RETRY_DELAY_SECONDS} seconds before retry...")
        time.sleep(RETRY_DELAY_SECONDS)
print("-" * 70)

# --- Display Results and Monitor Logs ---
if proxy_url:
    clear_output(wait=True)
    display(HTML(f"<div style='border: 2px solid #4CAF50; padding: 20px; border-radius: 10px; text-align: center; background-color: #f0fff0;'>" \
                 f"<h2 style='color: #2E7D32; margin-bottom:15px;'>ğŸ‰ Application Ready!</h2>" \
                 f"<p style='font-size:1.1em;'>Your Wolf_V5 analysis platform should be accessible via the link below:</p>" \
                 f"<p style='margin: 25px 0;'><a href='{proxy_url}' target='_blank' style='padding:12px 25px; background-color:#4CAF50; color:white; text-decoration:none; border-radius:5px; font-size:1.2em; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);'>ğŸš€ Click here to open Wolf_V5 Application</a></p>" \
                 f"<p style='font-size:0.9em; color:gray;'>Link address: <a href='{proxy_url}' target='_blank'>{proxy_url}</a></p>" \
                 f"<p style='font-size:0.9em; color:gray; margin-top:15px;'>If the application doesn't load after clicking, ensure this Colab Notebook cell is still running and try refreshing the page.</p>" \
                 f"<p style='font-size:0.9em; color:orange; margin-top:10px;'><b>Note: This cell will remain running to display application logs. To stop the service, manually interrupt the execution of this cell.</b></p>" \
                 f"</div>"))

    print("\n--- Application Logs (refreshes every 10 seconds) ---")
    print(f"Log source file: {LOG_FILE_PATH}")
    print("If the application encounters issues, relevant error messages may appear here.")
    print("You can stop the service at any time by manually interrupting this cell (click the stop button to the left of this cell in Colab, or use Ctrl+M I).")
    print("-" * 70, flush=True)

    def monitor_streamlit_process():
        streamlit_process.wait()
        if streamlit_process.returncode is not None:
            print(f"\nğŸ”´ Streamlit service has stopped (return code: {streamlit_process.returncode}). Please check logs. Log monitoring will now terminate.", flush=True)

    monitor_thread = threading.Thread(target=monitor_streamlit_process)
    monitor_thread.daemon = True
    monitor_thread.start()

    last_pos = 0
    try:
        while monitor_thread.is_alive():
            try:
                with open(LOG_FILE_PATH, 'r', encoding='utf-8') as f:
                    f.seek(last_pos)
                    new_logs = f.read()
                    if new_logs:
                        print(new_logs, end='', flush=True)
                        last_pos = f.tell()
            except FileNotFoundError:
                print(f"Warning: Log file {LOG_FILE_PATH} not found. Waiting for the application to create it...", flush=True)
            except Exception as e:
                print(f"Error reading log file: {e}", flush=True)

            if streamlit_process.poll() is not None:
                if monitor_thread.is_alive():
                    print("\nStreamlit process terminated, but monitor thread is still alive. Preparing to stop log monitoring.", flush=True)
                break

            time.sleep(10)
        print("\n--- Log monitoring loop ended (Streamlit service may have stopped) ---", flush=True)

    except KeyboardInterrupt:
        print("\nâŒ¨ï¸ Manual interruption detected (KeyboardInterrupt). Stopping service...", flush=True)
    except Exception as e_loop:
        print(f"\nğŸ’¥ Unexpected error in log monitoring loop: {e_loop}", flush=True)
    finally:
        print("\n--- Attempting to terminate Streamlit service ---", flush=True)
        if streamlit_process and streamlit_process.poll() is None:
            streamlit_process.terminate()
            try:
                streamlit_process.wait(timeout=10)
                print("âœ… Streamlit service terminated successfully.", flush=True)
            except subprocess.TimeoutExpired:
                print("âš ï¸ Streamlit service termination timed out, attempting to kill...", flush=True)
                streamlit_process.kill()
                streamlit_process.wait()
                print("Streamlit service killed.", flush=True)
        else:
            print("â„¹ï¸ Streamlit service had already stopped or did not start successfully.", flush=True)

        if monitor_thread and monitor_thread.is_alive():
            print("Waiting for log monitor thread to end...", flush=True)
            monitor_thread.join(timeout=5)
            if monitor_thread.is_alive():
                 print("Monitor thread did not end in time.", flush=True)
        print("--- Cell 2 execution finished ---", flush=True)

else:
    clear_output(wait=True)
    display(HTML(f"<div style='border: 2px solid #F44336; padding: 20px; border-radius: 10px; text-align: center; background-color: #fff0f0;'>" \
                 f"<h2 style='color: #C62828; margin-bottom:15px;'>âŒ Failed to automatically fetch Colab proxy URL</h2>" \
                 f"<p style='font-size:1.1em; color:#D32F2F;'>We could not automatically generate a clickable Colab proxy link for your application.</p>" \
                 f"<p style='color:orange; margin-top:15px;'>**Possible reasons and suggestions:**</p>" \
                 f"<ul style='text-align:left; display:inline-block; margin-top:10px;'>" \
                 f"<li>The Streamlit application might not have started successfully in the background (check for error messages).</li>" \
                 f"<li>Colab's proxy service might be temporarily unavailable or slow to respond.</li>" \
                 f"<li>You can try **re-running this cell**.</li>" \
                 f"<li>If the issue persists, please **check this cell's execution log for any error messages**. Streamlit itself might print an 'External URL' that you can try copying manually into your browser.</li>" \
                 f"</ul>" \
                 f"<p style='font-size:0.9em; color:gray; margin-top:20px;'>Note: The application needs to remain running in Colab to be accessible.</p>" \
                 f"</div>"))
    print("\nâŒ Failed to launch application or get link, cell will not remain active. Please check previous error messages.")

```
**Execution Notes:**
*   After execution, Colab will attempt to provide a URL like `https://[random_string].googleusercontent.com/proxy/8501/`. Click this link to open the application in a new browser tab.
*   **This cell will continue to run** to keep the Streamlit service alive and will display logs from `{GDRIVE_PROJECT_DIR}/logs/streamlit.log`.
*   To stop the service, **manually interrupt the execution of this cell** (e.g., by clicking the stop button to the left of the cell or using the shortcut `Ctrl+M I`).

### æ‡‰ç”¨ç¨‹å¼æ“ä½œæŒ‡å—

1.  **è¨­å®š Gemini API Key (é‡è¦)ï¼š**
    *   æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å¾Œï¼Œè«‹åœ¨å´é‚Šæ¬„çš„ "API è¨­å®š" å€åŸŸè¼¸å…¥æ‚¨çš„ Gemini API Keyã€‚å„ªå…ˆæ¨è–¦ä½¿ç”¨ Colab Secrets Manager (è©³è¦‹ä¸‹æ–¹é™„éŒ„ A)ã€‚`app.py` å·²è¨­è¨ˆç‚ºå„ªå…ˆå¾ Colab Secrets (åç¨± `GEMINI_API_KEY`) åŠ è¼‰é‡‘é‘°ã€‚
    *   ç„¡æœ‰æ•ˆ API Keyï¼ŒAI åˆ†æåŠŸèƒ½ç„¡æ³•ä½¿ç”¨ã€‚

2.  **å¾ Google Drive è®€å–åˆ†ææ–‡ä»¶ï¼š**
    *   åœ¨å´é‚Šæ¬„ "è®€å– Google Drive æ–‡ä»¶" å€åŸŸï¼Œè¼¸å…¥æ‚¨æƒ³åˆ†æçš„ã€å­˜æ–¼æ‚¨ Google Drive `My Drive` ä¸‹çš„**ç›¸å°æ–¼ `My Drive` çš„æ–‡ä»¶è·¯å¾‘** (ä¾‹å¦‚ `wolfAI/my_report.txt` æˆ– `Colab_Data/another_report.txt`)ã€‚
    *   **æ—¥æœŸè§£ææç¤ºï¼š** ç‚ºäº†è®“ AI èƒ½æ›´å¥½åœ°é€²è¡Œå¸‚å ´å›é¡§ï¼Œå»ºè­°æ‚¨çš„æ–‡æœ¬æ–‡ä»¶å…§å®¹ä¸­åŒ…å«æ˜ç¢ºçš„æ—¥æœŸæ¨™è­˜ï¼Œæ ¼å¼ç‚º `æ—¥æœŸï¼šYYYY-MM-DD`ã€‚æ‡‰ç”¨ç¨‹å¼æœƒå˜—è©¦å¾æ­¤æ¨™è­˜è§£æåŸºæº–æ—¥æœŸã€‚
    *   é»æ“Š "è®€å–ä¸¦è¨­ç‚ºç•¶å‰åˆ†ææ–‡ä»¶"ã€‚

3.  **é€²è¡Œ AI åˆæ­¥åˆ†æ (åŒ…å«å¸‚å ´å›é¡§)ï¼š**
    *   æ–‡ä»¶æˆåŠŸè®€å–å¾Œï¼Œä¸»èŠå¤©å€ä¸‹æ–¹æœƒå‡ºç¾ "AI åˆæ­¥åˆ†æ (åŒ…å«å¸‚å ´å›é¡§)" æŒ‰éˆ•ã€‚
    *   é»æ“Šæ­¤æŒ‰éˆ•ï¼š
        *   AI æœƒå°æ–‡æœ¬å…§å®¹é€²è¡Œæ‘˜è¦åˆ†æï¼ˆåŒ…æ‹¬ã€Œå–„ç”²ç‹¼ã€æ ¸å¿ƒè§€é»ç­‰ï¼‰ã€‚
        *   **å¸‚å ´å›é¡§ï¼š** AI æœƒå˜—è©¦æ ¹æ“šå¾æ–‡ä»¶ä¸­è§£æå‡ºçš„æ—¥æœŸï¼ˆè‹¥ç„¡å‰‡ä½¿ç”¨ç•¶å‰æ—¥æœŸï¼‰ï¼Œè‡ªå‹•ç²å–ä¸¦å±•ç¤ºå°ç£åŠ æ¬ŠæŒ‡æ•¸ (`^TWII`)ã€ç´æ–¯é”å…‹ç¶œåˆæŒ‡æ•¸ (`^IXIC`)ã€æ¨™æ™®500æŒ‡æ•¸ (`^GSPC`)ã€è²»åŸåŠå°é«”æŒ‡æ•¸ (`^SOX`)å’Œæ—¥ç¶“225æŒ‡æ•¸ (`^N225`) åœ¨è©²æ—¥æœŸå‰ä¸€é€±çš„**æ—¥ç·šèµ°å‹¢åœ–**å’Œ**æ•¸æ“šæ‘˜è¦**ã€‚é€™äº›åœ–è¡¨å’Œæ‘˜è¦å°‡ä½œç‚º AI åˆ†æçš„ä¸€éƒ¨åˆ†é¡¯ç¤ºåœ¨èŠå¤©å€ã€‚
        *   `yfinance` å¥—ä»¶ï¼ˆç”¨æ–¼ç²å–å¸‚å ´æ•¸æ“šï¼‰å·²åœ¨ Cell 1 ä¸­è‡ªå‹•å®‰è£ã€‚

4.  **èŠå¤©äº’å‹•ï¼š**
    *   æ‚¨å¯ä»¥åœ¨èŠå¤©å€åº•éƒ¨çš„è¼¸å…¥æ¡†ä¸­èˆ‡ AI é€²è¡Œå°è©±ã€‚é€²éšçš„èŠå¤©æŒ‡ä»¤åŠŸèƒ½ï¼ˆå¦‚æŸ¥è©¢ç‰¹å®šè‚¡ç¥¨æ•¸æ“šï¼‰æ­£åœ¨è¦åŠƒä¸­ã€‚

### æ³¨æ„äº‹é …
*   Colab Notebook éœ€ä¿æŒé‹è¡Œã€‚
*   ç’°å¢ƒé‡å•Ÿå¾Œéœ€é‡æ–°åŸ·è¡Œ Cell 1 å’Œ Cell 2ã€‚
*   ç¨‹å¼ç¢¼ä¸»è¦é€é GitHub æ›´æ–°ã€‚

---

## æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ (Viewing Application Logs)

æœ¬æ‡‰ç”¨ç¨‹å¼å…§å»ºäº†è©³ç´°çš„æ—¥èªŒè¨˜éŒ„åŠŸèƒ½ï¼Œä»¥å”åŠ©ä½¿ç”¨è€…å’Œé–‹ç™¼è€…è¿½è¹¤åŸ·è¡Œç‹€æ³åŠé€²è¡Œå•é¡Œæ’æŸ¥ã€‚

### å¦‚ä½•æŸ¥çœ‹æ—¥èªŒ

1.  **ä½ç½®**ï¼šåœ¨æ‡‰ç”¨ç¨‹å¼ä¸»é é¢çš„åº•éƒ¨ï¼Œä½ æœƒæ‰¾åˆ°ä¸€å€‹åç‚ºã€ŒğŸ“„ æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ (Application Logs)ã€çš„å¯å±•é–‹å€åŸŸã€‚
2.  **æ“ä½œ**ï¼šé»æ“Šè©²å€åŸŸå³å¯å±•é–‹ï¼ŒæŸ¥çœ‹å³æ™‚çš„æ‡‰ç”¨ç¨‹å¼æ—¥èªŒè¨Šæ¯ã€‚æ—¥èªŒæœƒé¡¯ç¤ºæœ€æ–°çš„äº‹ä»¶åœ¨æœ€ä¸Šæ–¹ã€‚
3.  **æ¸…é™¤æ—¥èªŒ**ï¼šåœ¨æ­¤å€åŸŸå…§é‚„æœ‰ä¸€å€‹ã€Œæ¸…é™¤æ—¥èªŒç´€éŒ„ã€æŒ‰éˆ•ï¼Œå¯ä»¥æ¸…é™¤ç•¶å‰é¡¯ç¤ºåœ¨ä»‹é¢ä¸­çš„æ—¥èªŒã€‚é€™ä¸æœƒå½±éŸ¿åˆ°ä¼ºæœå™¨æ§åˆ¶å°çš„æ—¥èªŒè¼¸å‡ºã€‚

### æ—¥èªŒç´šåˆ¥

æ—¥èªŒç´šåˆ¥é è¨­ç‚º `DEBUG`ã€‚é€™è¡¨ç¤ºæœƒè¨˜éŒ„éå¸¸è©³ç´°çš„æ‡‰ç”¨ç¨‹å¼åŸ·è¡Œä¿¡æ¯ï¼ŒåŒ…æ‹¬å‡½æ•¸èª¿ç”¨ã€è®Šæ•¸ç‹€æ…‹ã€API è«‹æ±‚èˆ‡å›æ‡‰ç­‰ã€‚é€™å°æ–¼æ·±å…¥äº†è§£æ‡‰ç”¨ç¨‹å¼çš„å…§éƒ¨é‹ä½œå’Œå¿«é€Ÿå®šä½å•é¡Œéå¸¸æœ‰å¹«åŠ©ã€‚

### æ—¥èªŒç”¨é€”

é€™äº›æ—¥èªŒä¸»è¦ç”¨æ–¼ï¼š
*   é–‹ç™¼è€…é€²è¡Œæ‡‰ç”¨ç¨‹å¼åµéŒ¯ã€‚
*   åœ¨é‡åˆ°é æœŸå¤–çš„è¡Œç‚ºæˆ–éŒ¯èª¤æ™‚ï¼Œæä¾›è©³ç´°çš„åŸ·è¡Œä¸Šä¸‹æ–‡ã€‚
*   å¹«åŠ©ç†è§£æ•¸æ“šè™•ç†å’Œ API äº’å‹•çš„æµç¨‹ã€‚

---
### é™„éŒ„ Aï¼šå®‰å…¨è¨­å®š Gemini API Key (æ¨è–¦)

(æ­¤éƒ¨åˆ†å…§å®¹èˆ‡ä¸Šä¸€ç‰ˆ README.md ç›¸åŒï¼Œä¿æŒä¸è®Š)
ç‚ºäº†æ›´å®‰å…¨å’ŒæŒä¹…åœ°ä½¿ç”¨ API Keyï¼Œå»ºè­°ä½¿ç”¨ Colab çš„ **Secrets Manager**ï¼š
1.  **åœ¨ Colab ä¸­æ·»åŠ å¯†é‘°ï¼š** å·¦å´é‘°åŒ™åœ–æ¨™ -> "+ æ–°å¢å¯†é‘°" -> åç¨± `GEMINI_API_KEY` -> è²¼ä¸Šé‡‘é‘°å€¼ -> å•Ÿç”¨ "ç­†è¨˜æœ¬è¨ªå•æ¬Šé™"ã€‚
2.  **æ‡‰ç”¨ç¨‹å¼ä¸­çš„è®€å–é‚è¼¯**ï¼šæ‡‰ç”¨ç¨‹å¼æœƒé€é `utils/session_state_manager.py` ä¸­çš„é‚è¼¯ï¼Œå„ªå…ˆå¾ Colab Secrets è®€å–åç‚º `GEMINI_API_KEY` çš„é‡‘é‘°ã€‚

---

# (English Content)

# Wolf_V5

## Project Goal
(Same as previous version)

## How to Run in Colab (New Two-Cell Process)
(Same as previous version, up to Prerequisites)

### Prerequisites
*   A valid Google account.
*   A Gemini API Key is recommended for full AI analysis features. Obtain one from [Google AI Studio](https://aistudio.google.com/app/apikey).

### Cell 1: Environment Setup and Project Deployment
Copy the entire script content below, paste it into the first code cell of your Colab Notebook, and then run this cell.
This cell will:
1.  Install necessary Python packages (`streamlit`, `google-generativeai`, `yfinance`, `pandas`).
2.  Mount your Google Drive.
3.  Create a `wolfAI` directory under `My Drive`.
4.  Clone/update the project code from GitHub (`https://github.com/hsp1234-web/Ai_wolf.git`) into `My Drive/wolfAI/`.

```python
#@title 1. Environment Setup & Ai_wolf Project Deployment (Click to expand code)
# === Colab Environment Setup & Ai_wolf Project Deployment ===
# Cell 1: Please run this cell to complete all initial setup.
import os

# --- 1. Install Necessary Python Packages ---
print("Installing necessary Python packages (streamlit, google-generativeai, yfinance, pandas)...")
!pip install streamlit google-generativeai yfinance pandas -q
# Added pandas because yfinance might need it, and it's also used in app.py
print("Package installation complete!\n")

# --- 2. Mount Google Drive ---
print("Attempting to mount Google Drive...")
from google.colab import drive
try:
    drive.mount('/content/drive', force_remount=True)
    print("Google Drive mounted successfully!\n")
except Exception as e:
    print(f"Failed to mount Google Drive: {e}")
    print("Please check the authorization steps in the pop-up window. If issues persist, try 'Runtime' -> 'Disconnect and delete runtime', then re-run this cell.") # Note: Colab-specific runtime management tip
    raise # Raise exception to stop execution if mounting fails

# --- 3. Define Project Path and Create Target Folder ---
# GDRIVE_PROJECT_DIR will be defined here, specifying the project directory in Google Drive
GDRIVE_PROJECT_DIR = "/content/drive/MyDrive/wolfAI"
print(f"Project will be deployed to Google Drive path: {GDRIVE_PROJECT_DIR}")
# Using !mkdir -p to execute a shell command to create the directory if it doesn't already exist
!mkdir -p "{GDRIVE_PROJECT_DIR}"
# åŒæ™‚å‰µå»ºæ—¥èªŒç›®éŒ„
!mkdir -p "{GDRIVE_PROJECT_DIR}/logs"
print(f"Project directory confirmed/created and logs directory created.\n")

# --- 4. Clone or Update Ai_wolf Project Code from GitHub ---
GIT_REPO_URL = "https://github.com/hsp1234-web/Ai_wolf.git"
GIT_DIR_CHECK = f"{GDRIVE_PROJECT_DIR}/.git" # Used to check if the .git directory exists, indicating a Git repository

print(f"Fetching latest code from {GIT_REPO_URL}...")
if os.path.isdir(GIT_DIR_CHECK): # Use os.path.isdir to check if the directory exists
    print("Existing project Git repository detected, attempting to update (git pull)...")
    import subprocess # Import subprocess module to execute shell commands
    # This is a more robust update method: first fetch and reset to the latest state of the remote main branch, then pull
    git_pull_command = f"cd '{GDRIVE_PROJECT_DIR}' && git fetch origin main && git reset --hard origin/main && git pull origin main"
    print(f"Executing update command: {git_pull_command}")
    process = subprocess.run(git_pull_command, shell=True, capture_output=True, text=True)
    if process.returncode == 0:
        print("Project update successful (git pull)!")
        if process.stdout: print(f"Git Pull Output:\n{process.stdout}")
        if process.stderr: print(f"Git Pull Error Messages (if any):\n{process.stderr}")
    else:
        print(f"git pull failed (return code: {process.returncode}). Error details:")
        print(process.stderr)
        print("This could be due to local merge conflicts or network issues. Consider manually deleting the 'wolfAI' directory in Google Drive and re-running this cell for a fresh clone.")
else:
    print(f"No existing .git repository found, cloning project from {GIT_REPO_URL} to {GDRIVE_PROJECT_DIR} ...")
    # Using !git clone to execute a shell command to clone the repository, --depth 1 for a shallow clone (latest commit only)
    !git clone --depth 1 "{GIT_REPO_URL}" "{GDRIVE_PROJECT_DIR}"
    print("Project cloning complete!")

print("\n--- 5. Verify Project Files ---")
print(f"Listing contents of {GDRIVE_PROJECT_DIR}:")
# Using !ls -la to execute a shell command to list file details (including hidden files)
!ls -la "{GDRIVE_PROJECT_DIR}"
APP_PY_PATH = f"{GDRIVE_PROJECT_DIR}/app.py" # Define the path to the main application file
# Check if the main app.py file exists
if os.path.isfile(APP_PY_PATH): # Use os.path.isfile to check if the file exists
    print(f"\nSuccessfully found the main application file: {APP_PY_PATH}")
    print("\nâœ… Cell 1 Setup Complete! You can now proceed to run Cell 2.")
else:
    print(f"\nâŒ Error: Main application file app.py not found in {GDRIVE_PROJECT_DIR}!")
    print(f"Please check if app.py exists in the GitHub repository ({GIT_REPO_URL}) at the root level or if there were errors in previous steps.")

```
**Execution Notes:**
*   Monitor Colab output.
*   **Google Drive Authorization:** Authorize when prompted.
*   **GitHub Updates:** The script attempts to pull the latest code.

### Cell 2: Launch the Streamlit Application and Monitor Logs
After Cell 1 executes successfully, copy the following into the second Colab cell and run it.
This cell will:
1. Launch the Streamlit application.
2. Attempt to fetch and display a publicly accessible Colab proxy URL.
3. **Remain running** to maintain the Streamlit service and will **output live application logs**.
4. You can stop the Streamlit service by **manually interrupting this cell (Interrupt execution)**.

```python
#@title 2. ğŸš€ Launch Wolf_V5 App, Get Link & Monitor Logs (Click to execute)
# === Wolf_V5 Project Launch, Link Retrieval & Log Monitoring ===
# Cell 2: Execute this cell to launch the Streamlit application, automatically fetch the access link, and continuously output logs.
#         You can manually interrupt this cell at any time to stop the service.

import subprocess
import time
import os
import threading # For monitoring the Streamlit process
from IPython.display import display, HTML, clear_output
from google.colab.output import eval_js

# --- Configuration Parameters ---
GDRIVE_PROJECT_DIR = "/content/drive/MyDrive/wolfAI" # Inherited from Cell 1 or redefined here
STREAMLIT_APP_PATH = f"{GDRIVE_PROJECT_DIR}/app.py"
LOG_DIR = f"{GDRIVE_PROJECT_DIR}/logs" # Log directory
LOG_FILE_PATH = f"{LOG_DIR}/streamlit.log" # Streamlit app should output logs here

PORT = 8501 # Port for the Streamlit app
WAIT_SECONDS_FOR_SERVER = 15
MAX_RETRIES_FOR_URL = 3
RETRY_DELAY_SECONDS = 5

# --- Clear Previous Output ---
# clear_output(wait=True) # Uncomment to clear previous output of this cell on each run

print("ğŸš€ Preparing to launch Streamlit application...")
print(f"   Application path: {STREAMLIT_APP_PATH}")
print(f"   Log file path: {LOG_FILE_PATH}")
print(f"   Expected listening port: {PORT}")
print("-" * 70)

# --- Check if app.py Exists ---
if not os.path.exists(STREAMLIT_APP_PATH):
    display(HTML(f"<p style='color:red; font-weight:bold;'>âŒ Error: Streamlit application file not found!</p>" \
                 f"<p style='color:red;'>   Please ensure the path <code style='color:red; background-color:#f0f0f0; padding:2px 4px; border-radius:3px;'>{STREAMLIT_APP_PATH}</code> is correct,</p>" \
                 f"<p style='color:red;'>   and that you have successfully executed all steps in Cell 1.</p>"))
    raise SystemExit("Application file app.py not found, terminating execution.")

# --- Ensure Log Directory and File Exist ---
os.makedirs(LOG_DIR, exist_ok=True)
with open(LOG_FILE_PATH, 'a') as f: # 'a' mode creates the file if it doesn't exist
    f.write(f"--- Colab script log monitoring started at {time.strftime('%Y-%m-%d %H:%M:%S')} ---\n")
print(f"Log file {LOG_FILE_PATH} confirmed/created.")
print("-" * 70)

# --- Launch Streamlit Server ---
streamlit_process = None
monitor_thread = None # Initialize monitor thread variable

try:
    print(f"â³ Attempting to launch Streamlit in the background (approx. {WAIT_SECONDS_FOR_SERVER} seconds)...")
    cmd = ["streamlit", "run", STREAMLIT_APP_PATH,
           "--server.port", str(PORT),
           "--server.headless", "true",
           "--browser.gatherUsageStats", "false"]

    streamlit_process = subprocess.Popen(cmd)

    print(f"   Streamlit launch command sent (PID: {streamlit_process.pid if streamlit_process else 'Unknown'}).")
    print(f"   Allowing server {WAIT_SECONDS_FOR_SERVER} seconds to initialize...")
    time.sleep(WAIT_SECONDS_FOR_SERVER)

    if streamlit_process.poll() is not None:
        display(HTML(f"<p style='color:red; font-weight:bold;'>âŒ Streamlit appears to have failed to start or terminated unexpectedly (return code: {streamlit_process.returncode}).</p>" \
                     f"<p style='color:orange;'>   Please check if `app.py` has syntax errors, or try checking Colab's 'Runtime' -> 'View runtime logs'.</p>" \
                     f"<p style='color:orange;'>   If your Streamlit application has internal logging (e.g., writing to {LOG_FILE_PATH}), that file might contain more clues.</p>"))
        raise SystemExit(f"Streamlit process failed to stay running (return code: {streamlit_process.returncode}).")

    print("âœ… Streamlit should now be running in the background.")
    print("-" * 70)

except Exception as e:
    display(HTML(f"<p style='color:red; font-weight:bold;'>âŒ An unexpected error occurred while launching Streamlit:</p>" \
                 f"<p style='color:red; font-family:monospace; white-space:pre-wrap;'>{str(e)}</p>" \
                 f"<p style='color:orange;'>   Please check the error message, ensure Streamlit is correctly installed, and paths are correct.</p>"))
    if streamlit_process and streamlit_process.poll() is None:
        streamlit_process.terminate()
    raise SystemExit(f"Failed to launch Streamlit: {str(e)}")

# --- Attempt to Get Colab Proxy URL ---
print("ğŸ”— Attempting to fetch Colab proxy access URL...")
proxy_url = None
for attempt in range(MAX_RETRIES_FOR_URL):
    print(f"   Attempt {attempt + 1}/{MAX_RETRIES_FOR_URL}...")
    try:
        proxy_url = eval_js(f'google.colab.kernel.proxyPort({PORT})')
        if proxy_url:
            print(f"   ğŸ‰ Successfully fetched proxy URL!")
            break
    except Exception as e_evaljs:
        print(f"      Failed to fetch URL on attempt {attempt + 1}: {str(e_evaljs)[:100]}...")
    if attempt < MAX_RETRIES_FOR_URL - 1:
        print(f"      Waiting {RETRY_DELAY_SECONDS} seconds before retry...")
        time.sleep(RETRY_DELAY_SECONDS)
print("-" * 70)

# --- Display Results and Monitor Logs ---
if proxy_url:
    clear_output(wait=True)
    display(HTML(f"<div style='border: 2px solid #4CAF50; padding: 20px; border-radius: 10px; text-align: center; background-color: #f0fff0;'>" \
                 f"<h2 style='color: #2E7D32; margin-bottom:15px;'>ğŸ‰ Application Ready!</h2>" \
                 f"<p style='font-size:1.1em;'>Your Wolf_V5 analysis platform should be accessible via the link below:</p>" \
                 f"<p style='margin: 25px 0;'><a href='{proxy_url}' target='_blank' style='padding:12px 25px; background-color:#4CAF50; color:white; text-decoration:none; border-radius:5px; font-size:1.2em; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);'>ğŸš€ Click here to open Wolf_V5 Application</a></p>" \
                 f"<p style='font-size:0.9em; color:gray;'>Link address: <a href='{proxy_url}' target='_blank'>{proxy_url}</a></p>" \
                 f"<p style='font-size:0.9em; color:gray; margin-top:15px;'>If the application doesn't load after clicking, ensure this Colab Notebook cell is still running and try refreshing the page.</p>" \
                 f"<p style='font-size:0.9em; color:orange; margin-top:10px;'><b>Note: This cell will remain running to display application logs. To stop the service, manually interrupt the execution of this cell.</b></p>" \
                 f"</div>"))

    print("\n--- Application Logs (refreshes every 10 seconds) ---")
    print(f"Log source file: {LOG_FILE_PATH}")
    print("If the application encounters issues, relevant error messages may appear here.")
    print("You can stop the service at any time by manually interrupting this cell (click the stop button to the left of this cell in Colab, or use Ctrl+M I).")
    print("-" * 70, flush=True)

    def monitor_streamlit_process():
        streamlit_process.wait()
        if streamlit_process.returncode is not None:
            print(f"\nğŸ”´ Streamlit service has stopped (return code: {streamlit_process.returncode}). Please check logs. Log monitoring will now terminate.", flush=True)

    monitor_thread = threading.Thread(target=monitor_streamlit_process)
    monitor_thread.daemon = True
    monitor_thread.start()

    last_pos = 0
    try:
        while monitor_thread.is_alive():
            try:
                with open(LOG_FILE_PATH, 'r', encoding='utf-8') as f:
                    f.seek(last_pos)
                    new_logs = f.read()
                    if new_logs:
                        print(new_logs, end='', flush=True)
                        last_pos = f.tell()
            except FileNotFoundError:
                print(f"Warning: Log file {LOG_FILE_PATH} not found. Waiting for the application to create it...", flush=True)
            except Exception as e:
                print(f"Error reading log file: {e}", flush=True)

            if streamlit_process.poll() is not None:
                if monitor_thread.is_alive():
                    print("\nStreamlit process terminated, but monitor thread is still alive. Preparing to stop log monitoring.", flush=True)
                break

            time.sleep(10)
        print("\n--- Log monitoring loop ended (Streamlit service may have stopped) ---", flush=True)

    except KeyboardInterrupt:
        print("\nâŒ¨ï¸ Manual interruption detected (KeyboardInterrupt). Stopping service...", flush=True)
    except Exception as e_loop:
        print(f"\nğŸ’¥ Unexpected error in log monitoring loop: {e_loop}", flush=True)
    finally:
        print("\n--- Attempting to terminate Streamlit service ---", flush=True)
        if streamlit_process and streamlit_process.poll() is None:
            streamlit_process.terminate()
            try:
                streamlit_process.wait(timeout=10)
                print("âœ… Streamlit service terminated successfully.", flush=True)
            except subprocess.TimeoutExpired:
                print("âš ï¸ Streamlit service termination timed out, attempting to kill...", flush=True)
                streamlit_process.kill()
                streamlit_process.wait()
                print("Streamlit service killed.", flush=True)
        else:
            print("â„¹ï¸ Streamlit service had already stopped or did not start successfully.", flush=True)

        if monitor_thread and monitor_thread.is_alive():
            print("Waiting for log monitor thread to end...", flush=True)
            monitor_thread.join(timeout=5)
            if monitor_thread.is_alive():
                 print("Monitor thread did not end in time.", flush=True)
        print("--- Cell 2 execution finished ---", flush=True)

else:
    clear_output(wait=True)
    display(HTML(f"<div style='border: 2px solid #F44336; padding: 20px; border-radius: 10px; text-align: center; background-color: #fff0f0;'>" \
                 f"<h2 style='color: #C62828; margin-bottom:15px;'>âŒ Failed to automatically fetch Colab proxy URL</h2>" \
                 f"<p style='font-size:1.1em; color:#D32F2F;'>We could not automatically generate a clickable Colab proxy link for your application.</p>" \
                 f"<p style='color:orange; margin-top:15px;'>**Possible reasons and suggestions:**</p>" \
                 f"<ul style='text-align:left; display:inline-block; margin-top:10px;'>" \
                 f"<li>The Streamlit application might not have started successfully in the background (check for error messages).</li>" \
                 f"<li>Colab's proxy service might be temporarily unavailable or slow to respond.</li>" \
                 f"<li>You can try **re-running this cell**.</li>" \
                 f"<li>If the issue persists, please **check this cell's execution log for any error messages**. Streamlit itself might print an 'External URL' that you can try copying manually into your browser.</li>" \
                 f"</ul>" \
                 f"<p style='font-size:0.9em; color:gray; margin-top:20px;'>Note: The application needs to remain running in Colab to be accessible.</p>" \
                 f"</div>"))
    print("\nâŒ Failed to launch application or get link, cell will not remain active. Please check previous error messages.")

```
**Execution Notes:**
*   After execution, Colab will attempt to provide a URL like `https://[random_string].googleusercontent.com/proxy/8501/`. Click this link to open the application in a new browser tab.
*   **This cell will continue to run** to keep the Streamlit service alive and will display logs from `{GDRIVE_PROJECT_DIR}/logs/streamlit.log`.
*   To stop the service, **manually interrupt the execution of this cell** (e.g., by clicking the stop button to the left of the cell or using the shortcut `Ctrl+M I`).

### æ‡‰ç”¨ç¨‹å¼æ“ä½œæŒ‡å—

1.  **è¨­å®š Gemini API Key (é‡è¦)ï¼š**
    *   æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•å¾Œï¼Œè«‹åœ¨å´é‚Šæ¬„çš„ "API è¨­å®š" å€åŸŸè¼¸å…¥æ‚¨çš„ Gemini API Keyã€‚å„ªå…ˆæ¨è–¦ä½¿ç”¨ Colab Secrets Manager (è©³è¦‹ä¸‹æ–¹é™„éŒ„ A)ã€‚`app.py` å·²è¨­è¨ˆç‚ºå„ªå…ˆå¾ Colab Secrets (åç¨± `GEMINI_API_KEY`) åŠ è¼‰é‡‘é‘°ã€‚
    *   ç„¡æœ‰æ•ˆ API Keyï¼ŒAI åˆ†æåŠŸèƒ½ç„¡æ³•ä½¿ç”¨ã€‚

2.  **å¾ Google Drive è®€å–åˆ†ææ–‡ä»¶ï¼š**
    *   åœ¨å´é‚Šæ¬„ "è®€å– Google Drive æ–‡ä»¶" å€åŸŸï¼Œè¼¸å…¥æ‚¨æƒ³åˆ†æçš„ã€å­˜æ–¼æ‚¨ Google Drive `My Drive` ä¸‹çš„**ç›¸å°æ–¼ `My Drive` çš„æ–‡ä»¶è·¯å¾‘** (ä¾‹å¦‚ `wolfAI/my_report.txt` æˆ– `Colab_Data/another_report.txt`)ã€‚
    *   **æ—¥æœŸè§£ææç¤ºï¼š** ç‚ºäº†è®“ AI èƒ½æ›´å¥½åœ°é€²è¡Œå¸‚å ´å›é¡§ï¼Œå»ºè­°æ‚¨çš„æ–‡æœ¬æ–‡ä»¶å…§å®¹ä¸­åŒ…å«æ˜ç¢ºçš„æ—¥æœŸæ¨™è­˜ï¼Œæ ¼å¼ç‚º `æ—¥æœŸï¼šYYYY-MM-DD`ã€‚æ‡‰ç”¨ç¨‹å¼æœƒå˜—è©¦å¾æ­¤æ¨™è­˜è§£æåŸºæº–æ—¥æœŸã€‚
    *   é»æ“Š "è®€å–ä¸¦è¨­ç‚ºç•¶å‰åˆ†ææ–‡ä»¶"ã€‚

3.  **é€²è¡Œ AI åˆæ­¥åˆ†æ (åŒ…å«å¸‚å ´å›é¡§)ï¼š**
    *   æ–‡ä»¶æˆåŠŸè®€å–å¾Œï¼Œä¸»èŠå¤©å€ä¸‹æ–¹æœƒå‡ºç¾ "AI åˆæ­¥åˆ†æ (åŒ…å«å¸‚å ´å›é¡§)" æŒ‰éˆ•ã€‚
    *   é»æ“Šæ­¤æŒ‰éˆ•ï¼š
        *   AI æœƒå°æ–‡æœ¬å…§å®¹é€²è¡Œæ‘˜è¦åˆ†æï¼ˆåŒ…æ‹¬ã€Œå–„ç”²ç‹¼ã€æ ¸å¿ƒè§€é»ç­‰ï¼‰ã€‚
        *   **å¸‚å ´å›é¡§ï¼š** AI æœƒå˜—è©¦æ ¹æ“šå¾æ–‡ä»¶ä¸­è§£æå‡ºçš„æ—¥æœŸï¼ˆè‹¥ç„¡å‰‡ä½¿ç”¨ç•¶å‰æ—¥æœŸï¼‰ï¼Œè‡ªå‹•ç²å–ä¸¦å±•ç¤ºå°ç£åŠ æ¬ŠæŒ‡æ•¸ (`^TWII`)ã€ç´æ–¯é”å…‹ç¶œåˆæŒ‡æ•¸ (`^IXIC`)ã€æ¨™æ™®500æŒ‡æ•¸ (`^GSPC`)ã€è²»åŸåŠå°é«”æŒ‡æ•¸ (`^SOX`)å’Œæ—¥ç¶“225æŒ‡æ•¸ (`^N225`) åœ¨è©²æ—¥æœŸå‰ä¸€é€±çš„**æ—¥ç·šèµ°å‹¢åœ–**å’Œ**æ•¸æ“šæ‘˜è¦**ã€‚é€™äº›åœ–è¡¨å’Œæ‘˜è¦å°‡ä½œç‚º AI åˆ†æçš„ä¸€éƒ¨åˆ†é¡¯ç¤ºåœ¨èŠå¤©å€ã€‚
        *   `yfinance` å¥—ä»¶ï¼ˆç”¨æ–¼ç²å–å¸‚å ´æ•¸æ“šï¼‰å·²åœ¨ Cell 1 ä¸­è‡ªå‹•å®‰è£ã€‚

4.  **èŠå¤©äº’å‹•ï¼š**
    *   æ‚¨å¯ä»¥åœ¨èŠå¤©å€åº•éƒ¨çš„è¼¸å…¥æ¡†ä¸­èˆ‡ AI é€²è¡Œå°è©±ã€‚é€²éšçš„èŠå¤©æŒ‡ä»¤åŠŸèƒ½ï¼ˆå¦‚æŸ¥è©¢ç‰¹å®šè‚¡ç¥¨æ•¸æ“šï¼‰æ­£åœ¨è¦åŠƒä¸­ã€‚

### æ³¨æ„äº‹é …
*   Colab Notebook éœ€ä¿æŒé‹è¡Œã€‚
*   ç’°å¢ƒé‡å•Ÿå¾Œéœ€é‡æ–°åŸ·è¡Œ Cell 1 å’Œ Cell 2ã€‚
*   ç¨‹å¼ç¢¼ä¸»è¦é€é GitHub æ›´æ–°ã€‚

---

## æŸ¥çœ‹æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ (Viewing Application Logs)

æœ¬æ‡‰ç”¨ç¨‹å¼å…§å»ºäº†è©³ç´°çš„æ—¥èªŒè¨˜éŒ„åŠŸèƒ½ï¼Œä»¥å”åŠ©ä½¿ç”¨è€…å’Œé–‹ç™¼è€…è¿½è¹¤åŸ·è¡Œç‹€æ³åŠé€²è¡Œå•é¡Œæ’æŸ¥ã€‚

### å¦‚ä½•æŸ¥çœ‹æ—¥èªŒ

1.  **ä½ç½®**ï¼šåœ¨æ‡‰ç”¨ç¨‹å¼ä¸»é é¢çš„åº•éƒ¨ï¼Œä½ æœƒæ‰¾åˆ°ä¸€å€‹åç‚ºã€ŒğŸ“„ æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ (Application Logs)ã€çš„å¯å±•é–‹å€åŸŸã€‚
2.  **æ“ä½œ**ï¼šé»æ“Šè©²å€åŸŸå³å¯å±•é–‹ï¼ŒæŸ¥çœ‹å³æ™‚çš„æ‡‰ç”¨ç¨‹å¼æ—¥èªŒè¨Šæ¯ã€‚æ—¥èªŒæœƒé¡¯ç¤ºæœ€æ–°çš„äº‹ä»¶åœ¨æœ€ä¸Šæ–¹ã€‚
3.  **æ¸…é™¤æ—¥èªŒ**ï¼šåœ¨æ­¤å€åŸŸå…§é‚„æœ‰ä¸€å€‹ã€Œæ¸…é™¤æ—¥èªŒç´€éŒ„ã€æŒ‰éˆ•ï¼Œå¯ä»¥æ¸…é™¤ç•¶å‰é¡¯ç¤ºåœ¨ä»‹é¢ä¸­çš„æ—¥èªŒã€‚é€™ä¸æœƒå½±éŸ¿åˆ°ä¼ºæœå™¨æ§åˆ¶å°çš„æ—¥èªŒè¼¸å‡ºã€‚

### æ—¥èªŒç´šåˆ¥

æ—¥èªŒç´šåˆ¥é è¨­ç‚º `DEBUG`ã€‚é€™è¡¨ç¤ºæœƒè¨˜éŒ„éå¸¸è©³ç´°çš„æ‡‰ç”¨ç¨‹å¼åŸ·è¡Œä¿¡æ¯ï¼ŒåŒ…æ‹¬å‡½æ•¸èª¿ç”¨ã€è®Šæ•¸ç‹€æ…‹ã€API è«‹æ±‚èˆ‡å›æ‡‰ç­‰ã€‚é€™å°æ–¼æ·±å…¥äº†è§£æ‡‰ç”¨ç¨‹å¼çš„å…§éƒ¨é‹ä½œå’Œå¿«é€Ÿå®šä½å•é¡Œéå¸¸æœ‰å¹«åŠ©ã€‚

### æ—¥èªŒç”¨é€”

é€™äº›æ—¥èªŒä¸»è¦ç”¨æ–¼ï¼š
*   é–‹ç™¼è€…é€²è¡Œæ‡‰ç”¨ç¨‹å¼åµéŒ¯ã€‚
*   åœ¨é‡åˆ°é æœŸå¤–çš„è¡Œç‚ºæˆ–éŒ¯èª¤æ™‚ï¼Œæä¾›è©³ç´°çš„åŸ·è¡Œä¸Šä¸‹æ–‡ã€‚
*   å¹«åŠ©ç†è§£æ•¸æ“šè™•ç†å’Œ API äº’å‹•çš„æµç¨‹ã€‚

---
### é™„éŒ„ Aï¼šå®‰å…¨è¨­å®š Gemini API Key (æ¨è–¦)

(æ­¤éƒ¨åˆ†å…§å®¹èˆ‡ä¸Šä¸€ç‰ˆ README.md ç›¸åŒï¼Œä¿æŒä¸è®Š)
ç‚ºäº†æ›´å®‰å…¨å’ŒæŒä¹…åœ°ä½¿ç”¨ API Keyï¼Œå»ºè­°ä½¿ç”¨ Colab çš„ **Secrets Manager**ï¼š
1.  **åœ¨ Colab ä¸­æ·»åŠ å¯†é‘°ï¼š** å·¦å´é‘°åŒ™åœ–æ¨™ -> "+ æ–°å¢å¯†é‘°" -> åç¨± `GEMINI_API_KEY` -> è²¼ä¸Šé‡‘é‘°å€¼ -> å•Ÿç”¨ "ç­†è¨˜æœ¬è¨ªå•æ¬Šé™"ã€‚
2.  **æ‡‰ç”¨ç¨‹å¼ä¸­çš„è®€å–é‚è¼¯**ï¼šæ‡‰ç”¨ç¨‹å¼æœƒé€é `utils/session_state_manager.py` ä¸­çš„é‚è¼¯ï¼Œå„ªå…ˆå¾ Colab Secrets è®€å–åç‚º `GEMINI_API_KEY` çš„é‡‘é‘°ã€‚

---
